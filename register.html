<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <!-- START: Ú©Ø¯ Ø¶Ø¯ Ú©Ø´ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ -->
 <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
 <meta http-equiv="Pragma" content="no-cache" />
 <meta http-equiv="Expires" content="0" />
 <!-- END: Ú©Ø¯ Ø¶Ø¯ Ú©Ø´ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡ -->

 <title>ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©</title>
 
 <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 
 <style>
    :root {
        /* Ù¾Ø§Ù„Øª Ø±Ù†Ú¯ÛŒ Ø¬Ø¯ÛŒØ¯: Ø¢Ø¨ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ Ùˆ Ø²Ø±Ø¯ Ø·Ù„Ø§ÛŒÛŒ (Ø§Ø² index.html) */
        --primary-color: #3A7DDE;       /* Ø¢Ø¨ÛŒ Ø§ØµÙ„ÛŒØŒ Ø¹Ù…ÛŒÙ‚ Ùˆ ÙØ§Ù†ØªØ²ÛŒ */
        --primary-light: #EAF2FF;       /* Ø¢Ø¨ÛŒ Ø¨Ø³ÛŒØ§Ø± Ø±ÙˆØ´Ù† Ø¨Ø±Ø§ÛŒ Ù‡Ø§ÙˆØ± */
        --secondary-color: #2C5A9E;     /* Ø¢Ø¨ÛŒ ØªÛŒØ±Ù‡â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª */
        --dark-color: #1A3D6D;          /* Ø¢Ø¨ÛŒ Ø¨Ø³ÛŒØ§Ø± ØªÛŒØ±Ù‡ Ø¨Ø±Ø§ÛŒ Ù…ØªÙˆÙ† Ø§ØµÙ„ÛŒ */
        --light-color: #f8f9fa;         /* Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø§ØµÙ„ÛŒ Ø¨Ø¯Ù†Ù‡ */
        --complementary-color: #FFC107; /* Ø²Ø±Ø¯ Ø·Ù„Ø§ÛŒÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø±Ù†Ú¯ Ù…Ú©Ù…Ù„ Ùˆ Ø¬Ø°Ø§Ø¨ */
        
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ø³Ø§Ø®ØªØ§Ø±ÛŒ (Ø§Ø² index.html) */
        --transition: all 0.3s ease;
        --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        --complementary-gradient: linear-gradient(135deg, var(--complementary-color), #d9a406);
        --border-radius: 20px;
        --button-border-radius: 12px;
        --border-color: #dee2e6;
        --disabled-color: #aaaaaa;
        --font-family: 'Vazirmatn', Arial, sans-serif;
        --font-size-base: 14px;
        
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¯Ø§Ø±Ú© Ù…ÙˆØ¯ (Ø­ÙØ¸ Ø´Ø¯Ù‡ Ø§Ø² index.html Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡) */
        --dark-mode-bg: #121212;
        --dark-mode-text: #ffffff;
        --dark-mode-card: #1e1e1e;
        --dark-mode-border: #333333;
        --arrow-color: #ef00f6; /* Ø§ÛŒÙ† Ø±Ù†Ú¯ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø«Ø§Ø¨Øª Ø¨Ù…Ø§Ù†Ø¯ ÛŒØ§ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ */
        
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ (Ø§Ø² index.html) */
        --shadow: 0 10px 25px rgba(58, 125, 222, 0.2);
        --card-shadow: 0 15px 35px rgba(58, 125, 222, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
        --subtle-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        --grey-color: #6c757d;
        --danger-color: #e74c3c;
        --text-color: #343a40; /* Ø±Ù†Ú¯ Ù…ØªÙ† Ø¹Ù…ÙˆÙ…ÛŒ */
        --text-light: #6c757d;
        --bg-color: #f8f9fa;    /* Ø§ÛŒÙ† Ù…ØªØºÛŒØ± Ø§Ú©Ù†ÙˆÙ† Ø¨Ø±Ø§ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ */
        --white: #ffffff;       /* Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡ ØµÙØ­Ù‡ Ùˆ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ */
        
        /* START: Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª */
        --success-color: #155724;
        --success-light-bg: #d4edda;
        --success-border-color: #c3e6cb;
        /* END: Ø±Ù†Ú¯â€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ø² Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª */
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
        font-family: var(--font-family);
        background-color: var(--white); /* Ø²Ù…ÛŒÙ†Ù‡ Ø³ÙÛŒØ¯ Ø®Ø§Ù„Øµ */
        direction: rtl; 
        text-align: right; 
        color: var(--text-color);
        line-height: 1.6; 
        display: flex; 
        justify-content: center; 
        align-items: center; 
        min-height: 100vh; 
        padding: 20px; 
    }
    
    .auth-container { 
        width: 90%;
        max-width: 450px;
        text-align: center; 
    }
    
    .logo-placeholder { 
        width: 200px;
        height: 60px;
        background-image: url('images/logo.png'); 
        background-size: contain; 
        background-repeat: no-repeat; 
        background-position: center; 
        margin: 0 auto 40px;
    }
    
    .intro-text {
        font-size: 16px;
        color: var(--text-color);
        margin-bottom: 30px;
        line-height: 1.8;
        text-align: center;
        padding: 0 10px;
    }
    
    .intro-text .app-name {
        font-weight: 600;
        color: var(--primary-color);
    }
    
    .form-group { 
        margin-bottom: 15px; 
        text-align: right; 
    }
    
    .form-row { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 15px; 
    }
    
    .form-group input { 
        width: 100%; 
        padding: 18px 20px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-color); /* Ø®Ø§Ú©Ø³ØªØ±ÛŒ Ø±ÙˆØ´Ù† Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ø§Ø³Øª */
        border-radius: var(--button-border-radius);
        font-family: var(--font-family);
        font-size: 16px; 
        text-align: right; 
        direction: rtl; 
        transition: var(--transition); 
        color: var(--dark-color);
    }
    
    .form-group input::placeholder {
        color: var(--grey-color);
        text-align: right;
    }
    
    .form-group input:focus { 
        outline: none; 
        box-shadow: 0 0 0 3px rgba(58, 125, 222, 0.15);
        background-color: var(--white);
        border: 1px solid var(--primary-color);
    }
    
    .form-group input.error { 
        border: 1px solid var(--danger-color);
        box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.15);
    }
    
    .password-strength { 
        margin-top: 5px; 
        font-size: 12px; 
        text-align: right; 
        padding-right: 5px; 
    }
    
    .auth-button { 
        width: 100%; 
        padding: 18px;
        margin-top: 30px;
        border: none; 
        border-radius: var(--button-border-radius);
        font-family: var(--font-family);
        font-size: 16px; 
        font-weight: 600; 
        cursor: pointer; 
        transition: var(--transition); 
        background: var(--gradient);
        color: white;
    }
    
    .auth-button:hover:not(:disabled) { 
        transform: translateY(-2px); 
        box-shadow: var(--shadow);
    }
    
    .auth-button:disabled { 
        opacity: 0.6; 
        cursor: not-allowed; 
        transform: none; 
    }
    
    .mode-switch { 
        margin-top: 25px;
        display: flex; 
        justify-content: center; 
        align-items: center;
        font-size: 14px;
    }
    
    .mode-switch p {
        margin-bottom: 0;
        margin-left: 5px;
        color: var(--grey-color);
    }
    
    .mode-switch button { 
        background: none; 
        border: none; 
        color: var(--dark-color);
        cursor: pointer; 
        font-family: var(--font-family);
        font-size: 14px; 
        text-decoration: none;
        font-weight: 500;
        padding: 0;
    }
    
    .mode-switch button:hover { 
        color: var(--primary-color);
        text-decoration: underline;
    }

    .message { 
        margin-top: 20px; 
        padding: 12px; 
        border-radius: 8px; 
        font-size: 14px; 
        text-align: center; 
    }
    
    .message.error { 
        background-color: #ffebee; 
        color: var(--danger-color);
        border: 1px solid #ffcdd2;
    }
    
    /* START: ØªØºÛŒÛŒØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø§Ø±Ø¨Ø± - Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø¨Ø² Ùˆ Ù…Ø´Ø®Øµ */
    .message.success { 
        background-color: var(--success-light-bg); 
        color: var(--success-color); 
        border: 1px solid var(--success-border-color);
        font-weight: 600; /* Ù…Ø´Ø®Øµâ€ŒØªØ± Ú©Ø±Ø¯Ù† ÙÙˆÙ†Øª */
    }
    /* END: ØªØºÛŒÛŒØ± Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø§Ø±Ø¨Ø± */

    .forgot-password-link {
        display: block;
        margin-top: 10px;
        font-size: 13px;
        color: var(--grey-color);
        text-decoration: none;
        text-align: center;
    }
    
    .forgot-password-link:hover {
        color: var(--primary-color);
        text-decoration: underline;
    }

    /* Modal styles for forgot password */
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .modal-backdrop.show {
        opacity: 1;
        visibility: visible;
    }
    
    .modal-content {
        background-color: var(--white);
        padding: 30px;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 400px;
        text-align: right;
        transform: translateY(-50px);
        opacity: 0;
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
        box-shadow: var(--card-shadow);
    }
    
    .modal-backdrop.show .modal-content {
        transform: translateY(0);
        opacity: 1;
    }
    
    .modal-header {
        font-size: 20px;
        font-weight: 700;
        color: var(--dark-color);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .modal-body p {
        font-size: 14px;
        color: var(--grey-color);
        margin-bottom: 20px;
        line-height: 1.7;
    }
    
    .modal-body input {
        width: 100%;
        padding: 15px 18px;
        border: 1px solid var(--border-color);
        background-color: var(--bg-color);
        border-radius: var(--button-border-radius);
        font-family: var(--font-family);
        font-size: 15px;
        text-align: right;
        direction: rtl;
        margin-bottom: 15px;
    }
    
    .modal-body input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(58, 125, 222, 0.15);
    }
    
    .modal-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
    }
    
    .modal-button {
        flex: 1;
        padding: 12px;
        border: none;
        border-radius: var(--button-border-radius);
        font-family: var(--font-family);
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
    }
    
    .modal-button.primary {
        background: var(--gradient);
        color: white;
    }
    
    .modal-button.primary:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }
    
    .modal-button.secondary {
        background-color: var(--bg-color);
        color: var(--dark-color);
        border: 1px solid var(--border-color);
    }
    
    .modal-button.secondary:hover {
        background-color: var(--primary-light);
    }
    
    .modal-message {
        margin-top: 15px;
        font-size: 13px;
        text-align: center;
    }
    
    .modal-message.success { color: var(--success-color); }
    .modal-message.error { color: var(--danger-color); }
 </style>
</head>
<body>

<div class="auth-container">
 <div class="logo-placeholder"></div>
 
 <p class="intro-text" id="main-intro-text">
 Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ùˆ ÛŒØ§ Ø«Ø¨Øª Ù†Ø§Ù… Ø¯Ø± <span class="app-name">Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©</span> Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯
 </p>

 <form id="authForm">
 <div id="name-fields" style="display: none;">
 <div class="form-row">
 <div class="form-group">
 <input type="text" id="firstName" placeholder="Ù†Ø§Ù…">
 </div>
 <div class="form-group">
 <input type="text" id="lastName" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
 </div>
 </div>
 </div>

 <div class="form-group">
 <input type="email" id="email" required placeholder="Ø§ÛŒÙ…ÛŒÙ„" autocomplete="email">
 </div>

 <div class="form-group">
 <input type="password" id="password" required placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±" autocomplete="current-password">
 <div id="password-strength" class="password-strength"></div>
 </div>

 <div class="form-group" id="confirm-password-field" style="display: none;">
 <input type="password" id="confirmPassword" placeholder="ØªØ£ÛŒÛŒØ¯ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
 </div>
 
 <button type="submit" class="auth-button" id="primary-action">
 <i class="fas fa-sign-in-alt"></i> ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©
 </button>
 </form>
 
 <a href="#" class="forgot-password-link" id="forgot-password-link">
 Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÙˆØ¯ Ø±Ø§ ÙØ±Ø§Ù…ÙˆØ´ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ
 </a>

 <div class="mode-switch">
 <p id="switch-text">Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ</p>
 <button type="button" id="mode-switch-btn">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯</button>
 </div>

 <div id="message" class="message" style="display: none;"></div>
</div>

<!-- Forgot Password Modal -->
<div id="forgot-password-modal" class="modal-backdrop">
 <div class="modal-content">
 <div class="modal-header">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</div>
 <div class="modal-body">
 <p>Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯.</p>
 <input type="email" id="forgot-password-email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ Ø´Ù…Ø§" required>
 <div id="forgot-password-message" class="modal-message" style="display: none;"></div>
 </div>
 <div class="modal-buttons">
 <button class="modal-button primary" id="send-reset-link-btn">Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
 <button class="modal-button secondary" id="cancel-reset-btn">Ù„ØºÙˆ</button>
 </div>
 </div>
</div>

<script>
    console.log("âœ… register.html: Script loaded");
    
    let currentMode = 'login';
    let currentDeviceId = null;
    
    // Ø¢Ø¯Ø±Ø³ Worker Ú©Ù„ÙˆØ¯ÙÙ„Ø± Ø´Ù…Ø§
    const WORKER_URL = 'https://weathered-sun-e806.toolbox-moein.workers.dev';
    
    // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø®Ø·Ø§Ù‡Ø§ÛŒ Worker Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ
    function translateWorkerError(message) {
        if (message.includes("Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.")) {
            return "Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù†Ø§Ù…ØŒ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒØŒ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.";
        }
        if (message.includes("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")) {
            return "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.";
        }
        if (message.includes("Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª.")) {
            return "Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.";
        }
        if (message.includes("Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.")) {
            return "Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.";
        }
        if (message.includes("Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.")) {
            return "Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯.";
        }
        if (message.includes("Ù†Ø´Ø³Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.")) {
            return "Ù†Ø´Ø³Øª Ø´Ù…Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯.";
        }
        if (message.includes("Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù¾ÛŒØ´ Ø¢Ù…Ø¯.")) {
            return "Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù¾ÛŒØ´ Ø¢Ù…Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.";
        }
        if (message.includes("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª")) {
            return "Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø³Ù…Øª Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.";
        }
        if (message.includes("Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.")) {
            return "Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.";
        }
        if (message.includes("ØªÙˆÚ©Ù† Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.")) {
            return "Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ù‡ÛŒØ¯.";
        }
        if (message.includes("Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")) {
            return "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.";
        }
        if (message.includes("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ù‚Øµ Ø§Ø³Øª.")) {
            return "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù†Ø§Ù‚Øµ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ø§Ø² Ù„ÛŒÙ†Ú© ØµØ­ÛŒØ­ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯.";
        }
        if (message.includes("Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.")) {
            return "Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.";
        }
        if (message.includes("login_conflict")) {
            return "Ø´Ù…Ø§ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡â€ŒØ§ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ø¯Ø± Ø¯Ø³ØªÚ¯Ø§Ù‡ Ø¬Ø¯ÛŒØ¯ ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒØ¯.";
        }
    
        return message;
    }
    
    // ØªÙˆÙ„ÛŒØ¯ Device ID
    function generateDeviceId() {
        let deviceId = localStorage.getItem('deviceId');
        if (!deviceId) {
            deviceId = 'device-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now();
            localStorage.setItem('deviceId', deviceId);
            console.log("Generated new deviceId:", deviceId);
        } else {
            console.log("Using existing deviceId:", deviceId);
        }
        return deviceId;
    }
    
    // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
    function showMessage(text, type = 'error') {
        const messageDiv = document.getElementById('message');
        messageDiv.textContent = text;
        messageDiv.className = `message ${type}`;
        messageDiv.style.display = 'block';
    }
    
    // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ Worker
    async function makeWorkerRequest(endpoint, data = null, method = 'GET') {
        const url = `${WORKER_URL}${endpoint}`;
        
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
        };
        
        if (data && method !== 'GET') {
            options.body = JSON.stringify(data);
        }
        
        console.log('Making request to:', url);
        
        try {
            const response = await fetch(url, options);
            const result = await response.json();
            
            console.log('Response status:', response.status);
            console.log('Response data:', result);
            
            return { 
                success: response.ok, 
                status: response.status,
                data: result 
            };
        } catch (error) {
            console.error('Request failed:', error); 
            return { 
                success: false, 
                error: 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø±Ø® Ø¯Ø§Ø¯' 
            };
        }
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª ÙØ¹Ø§Ù„
    async function checkExistingSession() {
        const sessionToken = localStorage.getItem('sessionToken');
        if (!sessionToken) {
            console.log("No sessionToken found");
            return false;
        }
        
        console.log("Found sessionToken, checking validity...");
        
        try {
            const response = await fetch(`${WORKER_URL}/getsession`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${sessionToken}`,
                    'X-Device-Id': currentDeviceId // Ø§Ø±Ø³Ø§Ù„ deviceId Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø±Ø³ÛŒ ØªØ¯Ø§Ø®Ù„
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.user) {
                    console.log("âœ… Valid session found, redirecting to index.html");
                    window.location.href = 'index.html';
                    return true;
                }
            } else {
                console.log("âŒ Invalid session, removing token");
                localStorage.removeItem('sessionToken');
            }
        } catch (error) {
            console.error("Session check error:", error);
            localStorage.removeItem('sessionToken');
        }
        
        return false;
    }
    
    // ÙˆØ±ÙˆØ¯
    async function performSignIn(email, password) {
        console.log("ğŸ”„ Attempting signin for:", email);
        
        try {
            const result = await makeWorkerRequest('/signin', { email, password, deviceId: currentDeviceId }, 'POST');
            
            if (result.success && result.data && result.data.sessionToken && result.data.user) {
                console.log("âœ… Signin successful");
                localStorage.setItem('sessionToken', result.data.sessionToken);
                showMessage('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²! Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...', 'success');
                
                setTimeout(() => {
                    console.log("ğŸ”„ Redirecting to index.html");
                    window.location.href = 'index.html';
                }, 1500);
                
                return true;
            } else {
                console.log("âŒ Signin failed");
                if (result.data && result.data.error === "login_conflict") {
                    const conflictingEmail = email;
                    window.location.href = `index.html?loginConflict=true&email=${encodeURIComponent(conflictingEmail)}`;
                    return false;
                }
                showMessage(translateWorkerError(result.data.error || 'Ø®Ø·Ø§ÛŒ ÙˆØ±ÙˆØ¯'), 'error');
                return false;
            }
        } catch (error) {
            console.error("âŒ Signin error:", error);
            showMessage('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± ÙˆØ±ÙˆØ¯', 'error');
            return false;
        }
    }
    
    // Ø«Ø¨Øª Ù†Ø§Ù…
    async function performSignUp(email, password, firstName, lastName) {
        console.log("ğŸ”„ Attempting signup for:", email);
        
        try {
            const result = await makeWorkerRequest('/signup', { firstName, lastName, email, password }, 'POST');
            
            if (result.success && result.data && result.data.sessionToken && result.data.user) {
                console.log("âœ… Signup successful");
                localStorage.setItem('sessionToken', result.data.sessionToken);
                showMessage('Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²! Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†ØªÙ‚Ø§Ù„...', 'success');
                
                setTimeout(() => {
                    console.log("ğŸ”„ Redirecting to index.html");
                    window.location.href = 'index.html';
                }, 1500);
                
                return true;
            } else {
                console.log("âŒ Signup failed");
                showMessage(translateWorkerError(result.data.error || 'Ø®Ø·Ø§ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…'), 'error');
                return false;
            }
        } catch (error) {
            console.error("âŒ Signup error:", error);
            showMessage('Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…', 'error');
            return false;
        }
    }
    
    // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
    async function requestPasswordResetInternal(email) {
        console.log("ğŸ”„ Requesting password reset for:", email);
        
        try {
            const result = await makeWorkerRequest('/forgot-password', { email }, 'POST');
            
            return {
                success: result.success,
                message: translateWorkerError(result.data.message || result.data.error || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ')
            };
        } catch (error) {
            console.error("âŒ Password reset error:", error);
            return {
                success: false,
                message: 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡'
            };
        }
    }
    
    // ØªØ¹ÙˆÛŒØ¶ Ø­Ø§Ù„Øª
    function switchMode() {
        const nameFields = document.getElementById('name-fields');
        const confirmPasswordField = document.getElementById('confirm-password-field');
        const primaryActionBtn = document.getElementById('primary-action');
        const mainIntroText = document.getElementById('main-intro-text');
        const switchText = document.getElementById('switch-text');
        const modeSwitchBtn = document.getElementById('mode-switch-btn');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const authForm = document.getElementById('authForm');
        const messageDiv = document.getElementById('message');
        const passwordStrength = document.getElementById('password-strength');
        
        currentMode = (currentMode === 'login') ? 'signup' : 'login';
        
        if (currentMode === 'signup') {
            mainIntroText.innerHTML = 'Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± <span class="app-name">Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©</span> Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯';
            primaryActionBtn.innerHTML = '<i class="fas fa-user-plus"></i> Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©';
            switchText.textContent = 'Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ';
            modeSwitchBtn.textContent = 'ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯';
            nameFields.style.display = 'block';
            confirmPasswordField.style.display = 'block';
            forgotPasswordLink.style.display = 'none';
        } else {
            mainIntroText.innerHTML = 'Ø¨Ø±Ø§ÛŒ ÙˆØ±ÙˆØ¯ Ùˆ ÛŒØ§ Ø«Ø¨Øª Ù†Ø§Ù… Ø¯Ø± <span class="app-name">Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©</span> Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ù†Ù…Ø§ÛŒÛŒØ¯';
            primaryActionBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©';
            switchText.textContent = 'Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ';
            modeSwitchBtn.textContent = 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯';
            nameFields.style.display = 'none';
            confirmPasswordField.style.display = 'none';
            forgotPasswordLink.style.display = 'block';
        }
        
        authForm.reset();
        messageDiv.style.display = 'none';
        passwordStrength.textContent = '';
        document.querySelectorAll('input.error').forEach(input => input.classList.remove('error'));
    }
    
    // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙØ±Ù…
    function validateForm() {
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const firstNameInput = document.getElementById('firstName');
        const lastNameInput = document.getElementById('lastName');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        
        let isValid = true;
        document.querySelectorAll('input.error').forEach(input => input.classList.remove('error'));
        
        if (!emailInput.value.trim()) { 
            emailInput.classList.add('error'); 
            isValid = false; 
        }
        if (!passwordInput.value) { 
            passwordInput.classList.add('error'); 
            isValid = false; 
        }
        
        if (currentMode === 'signup') {
            if (!firstNameInput.value.trim()) { 
                firstNameInput.classList.add('error'); 
                isValid = false; 
            }
            if (!lastNameInput.value.trim()) { 
                lastNameInput.classList.add('error'); 
                isValid = false; 
            }
            if (passwordInput.value.length < 6) {
                passwordInput.classList.add('error');
                showMessage('Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ 6 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.', 'error');
                isValid = false;
            }
            if (passwordInput.value !== confirmPasswordInput.value) {
                confirmPasswordInput.classList.add('error');
                showMessage('Ø±Ù…Ø²Ù‡Ø§ÛŒ Ø¹Ø¨ÙˆØ± Ù…Ø·Ø§Ø¨Ù‚Øª Ù†Ø¯Ø§Ø±Ù†Ø¯.', 'error');
                isValid = false;
            }
        }
        
        return isValid;
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø¯Ø±Øª Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ù‡Ù…Ø§Ù‡Ù†Ú¯ Ø´Ø¯Ù‡ Ø¨Ø§ Ù¾Ø§Ù„Øª Ø¬Ø¯ÛŒØ¯)
    function checkPasswordStrength(password) {
        const passwordStrength = document.getElementById('password-strength');
        
        if (currentMode !== 'signup' || !password) {
            passwordStrength.textContent = '';
            return;
        }
        
        let strength = 0;
        let feedback = '';
        let color = ''; 
        
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        if (password.length < 6) {
            feedback = 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø®ÛŒÙ„ÛŒ Ú©ÙˆØªØ§Ù‡ Ø§Ø³Øª';
            color = '#e74c3c'; // --danger-color
        } else if (strength < 3) {
            feedback = 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¶Ø¹ÛŒÙ Ø§Ø³Øª';
            color = '#FFC107'; // --complementary-color (Ø²Ø±Ø¯ Ø¨Ø±Ø§ÛŒ Ù‡Ø´Ø¯Ø§Ø±)
        } else if (strength < 4) {
            feedback = 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…ØªÙˆØ³Ø· Ø§Ø³Øª';
            color = '#3A7DDE'; // --primary-color (Ø¢Ø¨ÛŒ Ø§ØµÙ„ÛŒ)
        } else {
            feedback = 'Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù‚ÙˆÛŒ Ø§Ø³Øª';
            color = '#3A7DDE'; // --primary-color (Ø¢Ø¨ÛŒ Ø§ØµÙ„ÛŒ)
        }
        
        passwordStrength.textContent = feedback;
        passwordStrength.style.color = color; 
    }
    
    // Modal functions
    function showModal(modal) {
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('show'), 10);
    }
    
    function hideModal(modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.style.display = 'none';
            document.getElementById('forgot-password-email').value = '';
            document.getElementById('forgot-password-message').style.display = 'none';
        }, 300);
    }
    
    function showModalMessage(element, text, type) {
        element.textContent = text;
        element.className = `modal-message ${type}`;
        element.style.display = 'block';
    }
    
    // Event Listeners
    document.addEventListener('DOMContentLoaded', function() {
        console.log("âœ… DOM loaded");
        
        // ØªÙˆÙ„ÛŒØ¯ Device ID
        currentDeviceId = generateDeviceId();
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø³Øª Ù…ÙˆØ¬ÙˆØ¯
        checkExistingSession();
        
        // ØªØ¹ÙˆÛŒØ¶ Ø­Ø§Ù„Øª
        document.getElementById('mode-switch-btn').addEventListener('click', switchMode);
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø¯Ø±Øª Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
        document.getElementById('password').addEventListener('input', function(e) {
            checkPasswordStrength(e.target.value);
        });
        
        // Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù…
        document.getElementById('authForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log("=== FORM SUBMIT ===");
            
            if (!validateForm()) {
                console.log("âŒ Form validation failed");
                return;
            }
            
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');
            const primaryActionBtn = document.getElementById('primary-action');
            
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            
            primaryActionBtn.disabled = true;
            primaryActionBtn.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...';
            
            try {
                let success = false;
                
                if (currentMode === 'login') {
                    success = await performSignIn(email, password);
                } else {
                    success = await performSignUp(email, password, firstNameInput.value.trim(), lastNameInput.value.trim());
                }
                
                console.log("Auth result:", success ? "SUCCESS" : "FAILED");
                
            } catch (error) {
                console.error("âŒ Form submit error:", error);
                showMessage('Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡ Ø±Ø® Ø¯Ø§Ø¯', 'error');
            } finally {
                primaryActionBtn.disabled = false;
                primaryActionBtn.innerHTML = currentMode === 'login' 
                    ? '<i class="fas fa-sign-in-alt"></i> ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©'
                    : '<i class="fas fa-user-plus"></i> Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¯Ø± Ø¬Ø¹Ø¨Ù‡ Ø§Ø¨Ø²Ø§Ø± Ø§Ù…Ù„Ø§Ú©';
            }
        });
        
        // ÙØ±Ø§Ù…ÙˆØ´ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const forgotPasswordModal = document.getElementById('forgot-password-modal');
        const forgotPasswordEmailInput = document.getElementById('forgot-password-email');
        const sendResetLinkBtn = document.getElementById('send-reset-link-btn');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');
        const forgotPasswordMessageDiv = document.getElementById('forgot-password-message');
        
        forgotPasswordLink.addEventListener('click', function(e) {
            e.preventDefault();
            showModal(forgotPasswordModal);
            forgotPasswordEmailInput.value = document.getElementById('email').value;
        });
        
        cancelResetBtn.addEventListener('click', function() {
            hideModal(forgotPasswordModal);
        });
        
        forgotPasswordModal.addEventListener('click', function(e) {
            if (e.target === forgotPasswordModal) {
                hideModal(forgotPasswordModal);
            }
        });
        
        sendResetLinkBtn.addEventListener('click', async function() {
            const email = forgotPasswordEmailInput.value.trim();
            if (!email) {
                showModalMessage(forgotPasswordMessageDiv, "Ù„Ø·ÙØ§Ù‹ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.", 'error');
                return;
            }
            
            sendResetLinkBtn.disabled = true;
            forgotPasswordEmailInput.disabled = true;
            showModalMessage(forgotPasswordMessageDiv, "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ù„ÛŒÙ†Ú© Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ...", 'info');
            
            try {
                const result = await requestPasswordResetInternal(email); // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ØªØ§Ø¨Ø¹ Ø¯Ø§Ø®Ù„ÛŒ
                
                if (result.success) {
                    showModalMessage(forgotPasswordMessageDiv, result.message, 'success');
                    setTimeout(() => hideModal(forgotPasswordModal), 2000);
                } else {
                    showModalMessage(forgotPasswordMessageDiv, result.message, 'error');
                }
            } catch (error) {
                showModalMessage(forgotPasswordMessageDiv, "Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø±Ø® Ø¯Ø§Ø¯", 'error');
            } finally {
                sendResetLinkBtn.disabled = false;
                forgotPasswordEmailInput.disabled = false;
            }
        });
    });
    
    console.log("âœ… register.html: All event listeners attached");
</script>

</body>
</html>
