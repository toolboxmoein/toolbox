<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
 <!-- START: کد ضد کش اضافه شده (برای اطمینان از تازگی HTML) -->
 <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
 <meta http-equiv="Pragma" content="no-cache" />
 <meta http-equiv="Expires" content="0" />
 <!-- END: کد ضد کش اضافه شده -->

 <title>جعبه ابزار املاک</title>
 
 <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
 <link href="https://fonts.googleapis.com/css2?family=Khandevane:wght@400;500;600;700&display=swap" rel="stylesheet">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
 
 <!-- START: اضافه شده برای نمایش favicon.ico -->
 <link rel="icon" href="images/favicon.ico" type="image/x-icon">
 <!-- END: اضافه شده برای نمایش favicon.ico -->

 <style>
    :root {
        /* پالت رنگی جدید: آبی کهکشانی و زرد طلایی */
        --primary-color: #3A7DDE;       /* آبی اصلی، عمیق و فانتزی */
        --primary-light: #EAF2FF;       /* آبی بسیار روشن برای هاور */
        --secondary-color: #2C5A9E;     /* آبی تیره‌تر برای گرادینت */
        --dark-color: #1A3D6D;          /* آبی بسیار تیره برای متون اصلی */
        --light-color: #f8f9fa;         /* پس‌زمینه اصلی بدنه */
        --complementary-color: #FFC107; /* زرد طلایی به عنوان رنگ مکمل و جذاب */
        
        /* متغیرهای عمومی و ساختاری */
        --transition: all 0.3s ease;
        --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        --complementary-gradient: linear-gradient(135deg, var(--complementary-color), #d9a406);
        --border-radius: 20px;
        --button-border-radius: 12px;
        --border-color: #dee2e6;
        --disabled-color: #aaaaaa;
        --font-family: 'Vazirmatn', Arial, sans-serif;
        --font-size-base: 14px;
        
        /* متغیرهای دارک مود */
        --dark-mode-bg: #121212;
        --dark-mode-text: #ffffff;
        --dark-mode-card: #1e1e1e;
        --dark-mode-border: #333333;
        --arrow-color: #ef00f6; /* این رنگ می‌تواند ثابت بماند یا تغییر کند */
        
        /* متغیرهای باقی‌مانده برای سازگاری */
        --shadow: 0 10px 25px rgba(58, 125, 222, 0.2);
        --card-shadow: 0 15px 35px rgba(58, 125, 222, 0.1), 0 5px 15px rgba(0, 0, 0, 0.07);
        --subtle-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        --grey-color: #6c757d;
        --danger-color: #e74c3c;
        --text-color: #343a40;
        --text-light: #6c757d;
        --bg-color: #f8f9fa;
        --white: #ffffff;

        /* رنگ‌بندی برای دسته‌های اخبار */
        --real-estate-color: #FFC107; /* زرد طلایی برای مسکن */
        --economy-color: #008e3a; /* سبز برای اقتصاد */
        --politics-color: #0277bd; /* آبی برای سیاسی */
        --text-black-color: #343a40; /* برای متون سیاه در اخبار */
    }
    
    /* --- استایل‌های پایه و عمومی --- */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    html {
        scroll-behavior: smooth;
    }

    body {
        font-family: var(--font-family);
        background-color: var(--light-color); 
        direction: rtl;
        text-align: right;
        color: var(--text-color); 
        line-height: 1.6;
        position: relative;
        overflow-x: hidden;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        font-size: var(--font-size-base);
    }
    
    body.dark-mode {
        background-color: var(--dark-mode-bg);
        color: var(--dark-mode-text);
    }

    /* --- استایل‌های مربوط به احراز هویت و پیغام‌ها (از کد ۱) --- */
    .payment-notification {
        position: fixed; top: -150px; left: 50%; transform: translateX(-50%); width: 90%;
        max-width: 450px; background-color: var(--white); border-radius: var(--border-radius);
        box-shadow: var(--card-shadow); display: flex; align-items: center; padding: 16px 20px;
        z-index: 10001; transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        border-top: 4px solid; font-family: 'Vazirmatn', Arial, sans-serif;
    }
    .payment-notification.show { top: 20px; }
    .payment-notification.success { border-color: var(--primary-color); }
    .payment-notification.failed { border-color: var(--danger-color); }
    .notification-content strong { font-size: 16px; font-weight: 700; color: var(--dark-color); display: block; }
    .notification-content p { font-size: 14px; color: var(--grey-color); margin: 0; line-height: 1.5; }
    .notification-close { margin-right: auto; background: none; border: none; font-size: 24px; color: var(--grey-color); cursor: pointer; padding: 0 5px; }
    
    .no-session-container { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: var(--white); position: fixed; top: 0; left: 0; width: 100%; z-index: 9999; }
    .no-session-content { background: #fff; padding: 40px; border-radius: 0; box-shadow: none; width: 100%; max-width: 100%; height: 100vh; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .no-session-content h2 { margin-bottom: 20px; color: var(--dark-color); }
    .no-session-content p { margin-bottom: 30px; color: var(--grey-color); line-height: 1.6; }
    .no-session-content button { width: 100%; max-width: 450px; padding: 14px; border: none; border-radius: var(--button-border-radius); font-size: 16px; cursor: pointer; font-family: 'Vazirmatn', Arial, sans-serif; margin-bottom: 10px; transition: var(--transition); }
    .login-button { background: var(--gradient); color: white; }
    .login-button:hover { box-shadow: var(--shadow); transform: translateY(-2px); }

    /* --- هدر و سایدبار (ساختار از کد ۱، ظاهر بروز شده) --- */
    .header { 
        background-color: #ffffff; padding: 15px 0px 15px 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05); display: flex;
        justify-content: space-between; align-items: center;
        position: sticky; top: 0; z-index: 1000; 
    }
    body.dark-mode .header {
        background-color: var(--dark-mode-card);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    }
    .hamburger-menu { flex: 0 0 auto; display: flex; justify-content: flex-start; }
    .menu-tab-button { 
        background: none; /* Removed blue background */
        border: none;
        padding: 12px; /* Adjusted padding for icon-only look */
        font-family: var(--font-family);
        font-size: 16px; 
        font-weight: 600; 
        cursor: pointer;
        border-radius: 15px; /* More rounded for icon */
        transition: var(--transition);
        box-shadow: none; /* No shadow for plain icon button */
        color: var(--primary-color); /* Set icon color */
    }
    body.dark-mode .menu-tab-button {
        color: var(--dark-mode-text);
    }
    .menu-tab-button i { /* Style for hamburger icon */
        font-size: 24px; /* Larger icon */
        margin: 0;
    }
    .menu-tab-button:hover { 
        background-color: var(--primary-light); /* Light hover effect */
        transform: scale(1.05); /* Slight scale on hover */
    }
    .logo-container { flex-grow: 1; display: flex; justify-content: center; } 
    .logo-placeholder { 
        width: 160px; /* Increased logo size */
        height: 65px; /* Increased logo size */
        background-image: url('images/logo.png'); 
        background-size: contain; background-repeat: no-repeat;
        background-position: center;
    }
    .header-icons-wrapper {
        flex: 0 0 auto;
        display: flex; align-items: center; justify-content: flex-end;
        gap: 10px; padding-left: 10px;
    }
    .header-icon-button {
        background: none; border: none; font-size: 24px; cursor: pointer;
        width: 44px; height: 44px; border-radius: 50%; display: flex;
        justify-content: center; align-items: center; transition: var(--transition);
        text-decoration: none; position: relative;
    }
    .header-icon-button:hover { background-color: var(--primary-light); }
    #adsIcon, #messagesIcon { color: var(--primary-color); }
    
    .unread-badge {
        position: absolute; top: 4px; left: 4px; background-color: var(--danger-color);
        color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px;
        font-weight: 700; display: flex; justify-content: center; align-items: center;
        line-height: 1; border: 2px solid var(--white); display: none;
    }
    .unread-badge.show { display: flex; }

    .overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.5); z-index: 999; opacity: 0; visibility: hidden; transition: var(--transition); }
    .overlay.active { opacity: 1; visibility: visible; }
    
    .sidebar { position: fixed; top: 0; right: -100%; width: 75%; max-width: 360px; height: 100%; background-color: var(--white); box-shadow: -3px 0 15px rgba(0, 0, 0, 0.1); z-index: 1000; transition: right 0.3s ease-out; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; }
    .sidebar.active { right: 0; }
    .sidebar-header { display: flex; align-items: center; padding-bottom: 20px; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); position: relative; justify-content: flex-start; min-height: 60px; }
    .sidebar-logo { position: absolute; left: 50%; transform: translateX(-50%); display: flex; align-items: center; justify-content: center; height: auto; width: auto; max-width: calc(100% - 80px); }
    .sidebar-logo-image { height: 60px; width: auto; }
    .sidebar-close { flex-shrink: 0; margin-left: auto; position: relative; z-index: 10; background: none; border: none; font-size: 24px; color: var(--grey-color); cursor: pointer; padding: 5px; }
    .user-profile { padding: 10px 20px; margin-bottom: 15px; background: var(--gradient); border-radius: var(--border-radius); color: var(--white); text-align: center; }
    .user-avatar { display: none; }
    .user-info h3 { margin-top: 0; margin-bottom: 0; font-size: 15px; font-weight: 600; }
    .user-info p { display: none; }
    .sidebar-menu { display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px; }
    .sidebar-menu-item { display: flex; align-items: center; padding: 14px 16px; border-radius: var(--border-radius); text-decoration: none; color: var(--dark-color); transition: var(--transition); cursor: pointer; }
    .sidebar-menu-item:hover { background-color: var(--primary-light); transform: translateX(-5px); }
    .sidebar-menu-item.logout { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
    .sidebar-menu-item.logout:hover { background-color: #ffcdd2; }
    .sidebar-menu-icon { width: 40px; height: 40px; background-color: var(--primary-light); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-left: 15px; }
    .sidebar-menu-icon i { color: var(--primary-color); font-size: 18px; }
    .sidebar-menu-item.logout .sidebar-menu-icon i { color: #c62828; }
    .sidebar-menu-text { font-size: 15px; font-weight: 500; }
    .sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center; }
    .sidebar-version { font-size: 12px; color: var(--grey-color); }
    
    /* --- استایل‌های محتوای اصلی --- */
    #app-container {
        width: 100%;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        position: relative;
        background-color: #f2f2f2;
        padding-bottom: 70px; /* فضا برای نوار پایین */
    }
    body.dark-mode #app-container { background-color: var(--dark-mode-bg); }

    /* .top-banner-wrapper - این بخش به طور کامل حذف شده است */

    /* Rule for containers that are WRAPPERS for content (using padding for alignment) */
    .motivational-wrapper,
    .random-news-section-wrapper,
    .search-container,
    .price-component-container,
    .tab-content {
        margin: 15px auto 0;
        padding: 0 15px;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
    }

    /* Rule for containers that ARE the visible content (using margin for alignment) */
    .date-banner,
    .tabs-container {
        margin: 15px 15px 0; /* 15px top, 15px left/right, 0 bottom */
        width: calc(100% - 30px); /* Full width minus the left/right margins */
        max-width: 100%;
        box-sizing: border-box;
    }

    .date-banner {
        height: auto; 
        background: white; 
        display: flex; 
        justify-content: center;
        align-items: center; 
        color: black; 
        font-weight: 600; 
        font-size: 13px; 
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        border-radius: 12px; 
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        position: relative; 
        overflow: visible; 
        z-index: 20; 
        padding: 10px 15px; /* Inner padding for text */
        flex-wrap: wrap;
    }
    
    .date-banner .separator {
        color: var(--primary-color);
        margin: 0 5px;
        font-weight: bold;
    }

    .motivational-wrapper { 
        position: relative; /* Needed for absolute positioning of the label */
    }
    .motivational-label { /* NEW: Style for "متن امروز" label */
        position: absolute;
        top: -10px; /* Position above the container */
        right: 15px;
        background: var(--secondary-color);
        color: white;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    body.dark-mode .motivational-label {
        background-color: var(--dark-mode-card);
        color: var(--dark-mode-text);
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .motivational-quote-container {
        width: 100%;
        min-height: 60px; 
        background-color: white; border-radius: 12px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        display: flex; justify-content: center; align-items: center;
        padding: 15px 20px; 
        box-sizing: border-box;
        overflow: hidden; position: relative;
    }
    body.dark-mode .motivational-quote-container { background-color: var(--dark-mode-card); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
    #daily-quote {
        color: #333; font-size: 18px; font-weight: 500; text-shadow: none; margin: 0; width: 100%;
        text-align: center; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2;
        -webkit-box-orient: vertical; overflow: hidden;
    }
    body.dark-mode #daily-quote { color: var(--dark-mode-text); }

    .search-container { 
        /* Margin and padding handled by common rule above */
        display: none; /* Controlled by JS */
    }
    .search-container.active { display: block; animation: fadeIn 0.3s ease-in-out; }
    .search-box { position: relative; width: 100%; }
    .search-input { width: 100%; padding: 10px 40px 10px 15px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; font-family: var(--font-family); outline: none; }
    body.dark-mode .search-input { background-color: var(--dark-mode-bg); border-color: var(--dark-mode-border); color: var(--dark-mode-text); }
    .search-icon { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #999; font-size: 16px; }

    .price-component-container { 
        /* Margin and padding handled by common rule above */
        background-color: transparent; /* Parent bg, iframe handles its own bg */
        position: relative; 
        z-index: 1; 
    }
    body.dark-mode .price-component-container { background-color: var(--dark-mode-bg); }
    .price-label { /* NEW: Style for "قیمت لحظه‌ای" label, similar to motivational-label */
        position: absolute;
        top: -10px; /* Position above the container */
        right: 15px;
        background: var(--secondary-color);
        color: white;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    body.dark-mode .price-label {
        background-color: var(--dark-mode-card);
        color: var(--dark-mode-text);
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .price-iframe { 
        width: 100%; 
        height: 220px; /* Increased height to accommodate larger card */
        border: none; 
        border-radius: 12px; /* Consistent border-radius */
        overflow: hidden; 
        margin: 0; /* Remove default iframe margin */
        display: block; 
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Consistent shadow */
        background-color: white; /* Ensure iframe has a background */
    }
    body.dark-mode .price-iframe {
        background-color: var(--dark-mode-card); /* Ensure iframe background is dark in dark mode */
    }
    
    .tabs-container {
        /* Margin and width handled by new common rule above */
        background-color: white; 
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        margin-bottom: 0; /* Specific bottom margin for this section */
        position: relative;
        border-radius: 12px; /* Consistent border-radius */
    }
    body.dark-mode .tabs-container { background-color: var(--dark-mode-card); box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); }
    
    .tabs-nav { 
        display: flex; 
        align-items: center; 
        overflow-x: auto; 
        scrollbar-width: none; 
        -ms-overflow-style: none; 
        scroll-behavior: smooth; 
        padding: 0 20px; /* Inner padding for nav items */
    }
    .tabs-nav::-webkit-scrollbar { display: none; }
    
    .tab-button {
        background: none; border: none; padding: 15px 10px; font-size: 14px; font-weight: 500;
        color: #333333; cursor: pointer; transition: all 0.3s ease; border-bottom: 3px solid transparent;
        white-space: nowrap; min-width: 80px; text-align: center; font-family: var(--font-family); flex-shrink: 0;
    }
    body.dark-mode .tab-button { color: var(--dark-mode-text); }
    .tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-button:hover { color: var(--primary-color); }
    
    .tab-scroll-arrow {
        position: absolute; top: 50%; transform: translateY(-50%); width: 20px; height: 20px;
        background-color: rgba(255, 255, 255, 0.8); border-radius: 50%; display: flex;
        justify-content: center; align-items: center; z-index: 5; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        animation: pulse 1.5s infinite; pointer-events: none;
    }
    .tab-scroll-arrow.left { left: 5px; }
    .tab-scroll-arrow.right { right: 5px; }
    .tab-scroll-arrow i { color: var(--arrow-color); font-size: 12px; }
    .tab-scroll-arrow.hidden { display: none; }
    @keyframes pulse { 0% { transform: translateY(-50%) scale(1); opacity: 1; } 50% { transform: translateY(-50%) scale(1.2); opacity: 0.8; } 100% { transform: translateY(-50%) scale(1); opacity: 1; } }
    
    .tab-content { 
        display: none;
        padding-top: 15px; /* Add some top padding to separate from tabs nav */
    }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    
    .calc-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 0; margin-bottom: 0; } /* Padding/margin handled by parent sections */
    .calc-item { display: flex; flex-direction: column; align-items: center; gap: 8px; text-decoration: none; background-color: white; padding: 12px 8px; border-radius: 10px; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05); transition: all 0.3s ease; position: relative; }
    body.dark-mode .calc-item { background-color: var(--dark-mode-card); box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2); }
    .calc-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
    body.dark-mode .calc-item:hover { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
    .calc-image { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background-color: var(--primary-light); display: flex; justify-content: center; align-items: center; margin-bottom: 8px; }
    body.dark-mode .calc-image { background-color: rgba(58, 125, 222, 0.1); }
    .calc-image i { color: var(--primary-color); font-size: 24px; }
    .calc-name { font-size: 11px; color: #333; text-align: center; font-weight: 500; line-height: 1.3; }
    body.dark-mode .calc-name { color: var(--dark-mode-text); }
    .calc-item.disabled { opacity: 0.7; }
    .calc-item.disabled .calc-image { filter: grayscale(100%); }
    .calc-item.disabled .calc-name { color: var(--disabled-color); }
    
    .banner-container { grid-column: span 3; width: 100%; margin: 4px 0; }
    .banner-full {
        width: 100%; height: 0; padding-top: 40%; background-size: cover;
        background-position: center; border-radius: 12px; display: flex; align-items: center;
        justify-content: center; color: white; font-weight: 600; font-size: 14px; text-align: center;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); position: relative; overflow: hidden; text-decoration: none;
    }
    
    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background-color: white; display: flex; justify-content: space-around; padding: 12px 0; box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); z-index: 15; }
    body.dark-mode .bottom-nav { background-color: var(--dark-mode-card); box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2); }
    .nav-item { display: flex; flex-direction: column; align-items: center; color: #333; text-decoration: none; font-size: 11px; background-color: white; border-radius: 8px; padding: 5px 10px; transition: all 0.3s ease; }
    body.dark-mode .nav-item { background-color: var(--dark-mode-card); color: #aaa; }
    .nav-item i { color: var(--grey-color); transition: color 0.3s ease; font-size: 20px; margin-bottom: 4px; }
    .nav-item.active, .nav-item:hover { color: var(--primary-color); }
    .nav-item.active i, .nav-item:hover i { color: var(--primary-color); }
    .nav-item:nth-child(3) i { color: var(--complementary-color); } /* آیکون جستجو */
    .nav-item:nth-child(3).active i, .nav-item:nth-child(3):hover i { color: var(--complementary-color); }
    
    .toast-message {
        position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
        background-color: rgba(0, 0, 0, 0.8); color: white; padding: 12px 20px;
        border-radius: 8px; font-size: 14px; z-index: 1000; opacity: 0;
        transition: opacity 0.3s ease; text-align: center; max-width: 80%;
    }
    .toast-message.show { opacity: 1; }
    
    .favorite-icon {
        position: absolute; top: 5px; right: 5px; width: 25px; height: 25px;
        background-color: rgba(255, 255, 255, 0.8); border-radius: 50%;
        display: flex; justify-content: center; align-items: center; cursor: pointer;
        z-index: 10; transition: all 0.3s ease;
    }
    body.dark-mode .favorite-icon { background-color: rgba(30, 30, 30, 0.8); }
    .favorite-icon i { color: #ccc; font-size: 14px; transition: all 0.3s ease; }
    .favorite-icon.active i { color: #ff3b30; }
    .favorite-icon:hover { background-color: rgba(255, 255, 255, 1); transform: scale(1.1); }
    body.dark-mode .favorite-icon:hover { background-color: rgba(50, 50, 50, 0.8); }
    
    /* --- استایل مودال‌ها --- */
    #loading-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(255, 255, 255, 0.2); backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px); display: flex; justify-content: center;
        align-items: center; z-index: 9999; opacity: 1; transition: opacity 0.5s ease-out;
        pointer-events: none;
    }
    .spinner {
        width: 60px; height: 60px; border: 5px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary-color); border-radius: 50%;
        animation: spin 1.2s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .modal {
        display: none; position: fixed; z-index: 10002; left: 0; top: 0; width: 100%; height: 100%;
        overflow: auto; background-color: rgba(0,0,0,0.6); justify-content: center;
        align-items: center; font-family: 'Vazirmatn', Arial, sans-serif;
    }
    .modal.active { display: flex; }
    .modal-content {
        background-color: var(--white); margin: auto; padding: 30px; border-radius: var(--border-radius);
        box-shadow: var(--card-shadow); width: 90%; max-width: 450px; text-align: center;
        position: relative; animation: fadeIn 0.3s;
    }
    .modal-content h2 { margin-bottom: 15px; color: var(--dark-color); font-size: 24px; }
    .modal-content p { color: var(--grey-color); font-size: 16px; margin-bottom: 30px; }
    .modal-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
    .modal-actions button {
        width: 100%; padding: 14px; border: none; border-radius: var(--button-border-radius);
        font-size: 16px; cursor: pointer; font-family: 'Vazirmatn', Arial, sans-serif;
        transition: var(--transition); font-weight: 500;
    }
    .modal-actions .confirm-button { background: var(--gradient); color: white; }
    .modal-actions .confirm-button:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
    .modal-actions .cancel-button { background: none; color: var(--grey-color); border: 1px solid var(--border-color); }
    .modal-actions .cancel-button:hover { background-color: var(--primary-light); }
    
    .limit-modal {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.7);
        z-index: 2000; display: none; align-items: center; justify-content: center; padding: 20px;
    }
    .limit-modal.active { display: flex; }
    .limit-modal-content {
        background-color: white; border-radius: 15px; padding: 30px; max-width: 400px;
        width: 100%; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    body.dark-mode .limit-modal-content { background-color: var(--dark-mode-card); color: var(--dark-mode-text); }
    .limit-modal-title { font-size: 18px; font-weight: 600; color: var(--primary-color); margin-bottom: 15px; font-family: var(--font-family); }
    .limit-modal-text { font-size: 14px; line-height: 1.6; margin-bottom: 25px; color: #666; font-family: var(--font-family); }
    body.dark-mode .limit-modal-text { color: #aaa; }
    .limit-modal-buttons { display: flex; gap: 10px; justify-content: center; }
    .limit-modal-btn { padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; font-family: var(--font-family); }
    .limit-modal-btn.primary { background: var(--gradient); color: white; }
    .limit-modal-btn.primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(58, 125, 222, 0.3); }
    .limit-modal-btn.secondary { background-color: #f0f0f0; color: #333; }
    body.dark-mode .limit-modal-btn.secondary { background-color: var(--dark-mode-bg); color: var(--dark-mode-text); }
    
    #allToolsModal.modal { background-color: white; transform: translateY(100%); transition: transform 0.3s ease; padding-bottom: 70px; }
    body.dark-mode #allToolsModal.modal { background-color: var(--dark-mode-bg); }
    #allToolsModal.modal.active { transform: translateY(0); }
    #allToolsModal .modal-content { width: 100%; height: 100%; background-color: white; padding: 0; overflow-y: auto; position: relative; max-width: none; border-radius: 0; box-shadow: none; animation: none; }
    body.dark-mode #allToolsModal .modal-content { background-color: var(--dark-mode-bg); }
    .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background-color: white; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 10; }
    body.dark-mode .modal-header { background-color: var(--dark-mode-card); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); }
    .modal-title { font-size: 18px; font-weight: 600; color: var(--primary-color); }
    .close-modal { width: 30px; height: 30px; background-color: #ff3b30; border: none; border-radius: 50%; color: white; font-size: 16px; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.3s ease; }
    .close-modal:hover { transform: rotate(90deg); background-color: #e60000; }
    .modal-section-title { padding: 15px 20px 5px; font-size: 16px; font-weight: 600; color: var(--primary-color); }
    .modal-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 10px 20px 20px; }
    .modal-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; background-color: white; padding: 12px 8px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); transition: all 0.3s ease; position: relative; }
    body.dark-mode .modal-item { background-color: var(--dark-mode-card); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); }
    .modal-item:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
    body.dark-mode .modal-item:hover { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
    .modal-item-icon { width: 45px; height: 45px; border-radius: 50%; overflow: hidden; background-color: var(--primary-light); display: flex; justify-content: center; align-items: center; margin-bottom: 8px; }
    body.dark-mode .modal-item-icon { background-color: rgba(58, 125, 222, 0.1); }
    .modal-item-icon i { color: var(--primary-color); font-size: 24px; }
    .modal-item-name { font-size: 11px; color: #333; text-align: center; font-weight: 500; line-height: 1.3; }
    body.dark-mode .modal-item-name { color: var(--dark-mode-text); }
    
    /* استایل‌های مربوط به حالت دسکتاپ و ریسپانسیو */
    @media (max-width: 768px) {
        .logo-placeholder { width: 150px; height: 60px; }
        .menu-tab-button { font-size: 14px; padding: 10px; } /* Adjusted padding */
        .sidebar { width: 90%; }
        .header-icons-wrapper { flex-basis: auto; padding-left: 10px; }
    }
    
    @media (max-width: 480px) {
        .calc-image, .modal-item-icon { width: 40px; height: 40px; }
        .calc-name, .modal-item-name { font-size: 10px; }
        .calc-item, .modal-item { padding: 10px 6px; }
        .modal-grid { gap: 8px; }
        .modal-item-icon i { font-size: 18px; }
        .tab-button { font-size: 12px; padding: 12px 8px; min-width: 70px; }
        .favorite-icon { width: 22px; height: 22px; top: 3px; right: 3px; }
        .favorite-icon i { font-size: 12px; }
        #daily-quote { font-size: 16px; }
        .menu-tab-button i { font-size: 20px; } /* Smaller icon on mobile */
    }

    /* استایل‌های حالت پرداخت از کد ۱ */
    #payment-container { display: flex; justify-content: center; align-items: center; height: 100vh; background-color: var(--light-color); position: fixed; top: 0; left: 0; width: 100%; z-index: 9998; }
    #payment-container > div { background: #fff; padding: 40px; border-radius: var(--border-radius); box-shadow: var(--card-shadow); width: 100%; max-width: 450px; text-align: center; }
    #payment-container h2 { margin-bottom: 10px; color: var(--dark-color); }
    #payment-container p { margin-top: 10px; margin-bottom: 25px; color: var(--grey-color); font-size: 15px; }
    #payment-container button { width: 100%; padding: 14px; border: none; border-radius: var(--button-border-radius); font-size: 16px; cursor: pointer; font-family: 'Vazirmatn', Arial, sans-serif; margin-bottom: 10px; transition: var(--transition); }
    #payment-container #pay-now-button { background: var(--gradient); color: white; }
    #payment-container #pay-now-button:hover { box-shadow: var(--shadow); transform: translateY(-2px); }
    #payment-container #logout-button-payment { background: none; color: var(--grey-color); border: 1px solid var(--border-color); }
    #payment-container #logout-button-payment:hover { background-color: var(--primary-light); }
    #payment-container #payment-message { margin-top: 20px; color: red; font-size: 14px; }
    body.loading::after { 
        content: ''; 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(255, 255, 255, 0.7) 
                    url('data:image/svg+xml;charset=UTF-8,%3csvg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg"%3e%3cstyle%3e.spinner_V8m1%7btransform-origin:center;animation:spinner_zKoa 2s linear infinite%7d.spinner_V8m1 circle%7bstroke-linecap:round;animation:spinner_YpZS 1.5s ease-in-out infinite%7d@keyframes spinner_zKoa%7b100%25%7btransform:rotate(360deg)%7d%7d@keyframes spinner_YpZS%7b0%25%7bstroke-dasharray:0 150;stroke-dashoffset:0%7d47.5%25%7bstroke-dasharray:42 150;stroke-dashoffset:-16%7d95%25,100%25%7bstroke-dasharray:42 150;stroke-dashoffset:-59%7d%7d%3c/style%3e%3cg class="spinner_V8m1"%3e%3ccircle cx="20" cy="20" r="9.5" fill="none" stroke="%233A7DDE" stroke-width="3"%3e%3c/circle%3e%3c/g%3e%3c/svg%3e') 
                    center / 50px no-repeat; 
        z-index: 10000; 
    }
    body.loading { pointer-events: none; }
    
    .header, #app-container { display: none; }

    /* --- استایل‌های بخش اخبار رندوم --- */
    .random-news-section-wrapper {
        /* Margin and padding handled by common rule above */
        display: none; /* Hidden by default, shown when content is ready */
        position: relative; /* Needed for absolute positioning of the label */
        background-color: transparent; /* Ensure no background interferes with card shadow */
    }
    .news-label { /* NEW: Style for "اخبار" label, similar to motivational-label */
        position: absolute;
        top: -10px; /* Position above the container */
        right: 15px;
        background: var(--secondary-color);
        color: white;
        padding: 4px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    body.dark-mode .news-label {
        background-color: var(--dark-mode-card);
        color: var(--dark-mode-text);
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .news-highlights-grid { /* Changed to flex for single item centering */
        display: flex;
        justify-content: center; /* Center the single news card */
        align-items: flex-start; /* Align item to top if height varies */
        width: 100%;
        max-width: 1200px; /* Max width for the container */
        margin: 0 auto; /* Centered horizontally within its parent */
        height: 80px; /* Fixed height for the grid to hold the card */
    }

    /* Styles for individual news items, adapting calc-item */
    .news-item-card { /* Custom class for news items to distinguish them from generic calc-items */
        display: flex;
        flex-direction: column;
        text-decoration: none;
        background-color: white;
        padding: 10px 15px; /* Adjusted padding */
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        position: relative;
        width: 100%; /* Take full width of parent (flex item) */
        max-width: 450px; /* Limit max width for consistency with other cards */
        height: 80px; /* Fixed height for the card, smaller than 200px iframe */
        overflow: hidden; /* Hide overflowing content */
        justify-content: center; /* Center content vertically */
        align-items: center; /* Center content horizontally */
        text-align: center; /* Center text within the card */
        cursor: pointer; /* Indicate it's clickable */
    }
    body.dark-mode .news-item-card {
        background-color: var(--dark-mode-card);
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
    }
    .news-item-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    body.dark-mode .news-item-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .news-item-card .card-content { /* Wrapper for text content inside news card */
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        width: 100%;
        justify-content: center; /* Vertically center title and cue */
        align-items: center; /* Horizontally center title and cue */
        gap: 5px; /* Small gap between title and cue */
    }

    /* Hide category badge */
    .news-item-card .news-category-badge {
        display: none;
    }

    .news-item-card .news-title-text {
        font-size: 18px; /* Increased font size to match motivational quote */
        font-weight: 600;
        color: var(--dark-color);
        line-height: 1.3;
        display: -webkit-box;
        -webkit-line-clamp: 1; /* Limit to 1 line */
        line-clamp: 1;
        -webkit-box-orient: vertical;
        overflow: hidden;
        margin: 0; /* Remove any default margins */
        text-align: center; /* Ensure title text is centered */
        max-width: 90%; /* Prevent title from hitting edges */
    }
    body.dark-mode .news-item-card .news-title-text {
        color: var(--dark-mode-text);
    }

    .news-item-card .news-footer-info { /* Re-purposed to hold only the "ادامه خبر" cue */
        display: flex;
        justify-content: center; /* Center the cue */
        align-items: center;
        margin-top: auto; /* Push to bottom */
        padding-top: 5px; /* Small padding above cue */
        /* No border-top needed if only cue is here */
    }

    .news-item-card .news-source-date { /* Hidden by default for this card type */
        display: none; 
    }
    .news-item-card .read-more-cue { /* Style for "ادامه خبر" */
        font-size: 11px;
        color: var(--primary-color);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 3px;
    }
    .news-item-card .read-more-cue i {
        font-size: 9px;
    }


    /* Loading/Error/No News for random section */
    .info-message {
        text-align: center;
        padding: 15px;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin: 0 auto; /* Centered in its parent */
        max-width: 450px; /* Match news card max width */
        height: 80px; /* Match news card height */
        display: none; /* Hidden by default */
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100%; /* Take full width of parent flex item */
    }
    .info-message.loading i {
        font-size: 18px; /* Reduced font size */
        animation: spin 1s linear infinite;
        color: var(--primary-color);
        margin-bottom: 5px;
    }
    .info-message h3 {
        font-size: 1rem; /* Reduced font size */
        color: var(--dark-color);
        margin-bottom: 8px; /* Reduced margin */
    }
    .info-message p {
        font-size: 0.85rem; /* Reduced font size */
        color: var(--grey-color);
    }
    body.dark-mode .info-message {
        background-color: var(--dark-mode-card);
        color: var(--dark-mode-text);
    }
    body.dark-mode .info-message h3 {
        color: var(--dark-mode-text);
    }

    /* Responsive adjustments for random news section */
    @media (max-width: 480px) {
        .news-highlights-grid {
            gap: 10px;
        }
        .news-item-card {
            height: 75px; /* Slightly smaller height on mobile */
            padding: 10px; /* Further reduced padding */
        }
        .news-item-card .news-title-text {
            font-size: 16px; /* Reduced font size for smaller screens */
            min-height: auto;
        }
        .news-item-card .read-more-cue {
            font-size: 9px;
        }
        .news-item-card .read-more-cue i {
            font-size: 7px;
        }
        .motivational-label, .news-label, .price-label {
            font-size: 11px;
            padding: 3px 10px;
            top: -8px;
        }
    }
    
 </style>
</head>
<body>

<!-- صفحه لودینگ -->
<div id="loading-overlay">
    <div class="spinner"></div>
</div>

<!-- ساختارهای مودال و پیام‌ها -->
<div id="no-session-container" class="no-session-container" style="display: none;">
 <div class="no-session-content">
 <i class="fas fa-sign-in-alt" style="font-size: 60px; color: var(--primary-color); margin-bottom: 20px;"></i>
 <h2>ورود به حساب کاربری</h2>
 <p>برای استفاده از جعبه ابزار املاک، لطفاً ابتدا وارد حساب کاربری خود شوید یا حساب جدید ایجاد کنید.</p>
 <button class="login-button" onclick="goToRegister()">
 <i class="fas fa-user-plus"></i> ورود / ثبت‌نام
 </button>
 </div>
</div>

<div id="payment-notification" class="payment-notification">
 <i id="notification-icon" class="notification-icon fas"></i>
 <div class="notification-content"><strong id="notification-title"></strong><p id="notification-message"></p></div>
 <button id="notification-close" class="notification-close">&times;</button>
</div>

<div id="multiDeviceModal" class="modal">
 <div class="modal-content">
 <i class="fas fa-exclamation-triangle" style="font-size: 50px; color: var(--danger-color); margin-bottom: 20px;"></i>
 <h2>ورود از دستگاه دیگر</h2>
 <p id="multiDeviceMessage">شما با ایمیل <strong id="conflictingEmailDisplay"></strong> در دستگاه دیگری وارد شده‌اید. آیا می‌خواهید از آن دستگاه خارج و در این دستگاه وارد شوید؟</p>
 <div class="modal-actions">
 <button id="confirmSwitchDevice" class="confirm-button">بله، وارد شوم</button>
 <button id="cancelSwitchDevice" class="cancel-button">خیر، لغو</button>
 </div>
 </div>
</div>

<div class="modal" id="allToolsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">همه ابزارها</h3>
            <button class="close-modal" id="closeAllToolsModal">×</button>
        </div>
        <div class="modal-section-title">ابزارهای فعال</div>
        <div class="modal-grid">
            <!-- Active Calculations -->
            <a href="apartment-calculator.html" class="modal-item limited-feature" data-feature="apartment-calculator">
                <div class="modal-item-icon"><i class="fas fa-building"></i></div>
                <div class="modal-item-name">قیمت آپارتمان</div>
                <div class="favorite-icon" data-id="calc1"><i class="far fa-heart"></i></div>
            </a>
            <a href="villa-calculator.html" class="modal-item limited-feature" data-feature="villa-calculator">
                <div class="modal-item-icon"><i class="fas fa-home"></i></div>
                <div class="modal-item-name">قیمت ویلا</div>
                <div class="favorite-icon" data-id="calc2"><i class="far fa-heart"></i></div>
            </a>
            <a href="rent-converter.html" class="modal-item limited-feature" data-feature="rent-converter">
                <div class="modal-item-icon"><i class="fas fa-exchange-alt"></i></div>
                <div class="modal-item-name">تبدیل رهن و اجاره</div>
                <div class="favorite-icon" data-id="calc4"><i class="far fa-heart"></i></div>
            </a>
            <a href="hesabdari.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-chart-line"></i></div>
                <div class="modal-item-name">حسابداری</div>
                <div class="favorite-icon" data-id="calc11"><i class="far fa-heart"></i></div>
            </a>
            <a href="apartment-share-calculator.html" class="modal-item limited-feature" data-feature="apartment-share-calculator">
                <div class="modal-item-icon"><i class="fas fa-calculator"></i></div>
                <div class="modal-item-name">قدرالسهم آپارتمان</div>
                <div class="favorite-icon" data-id="calc9"><i class="far fa-heart"></i></div>
            </a>

            <!-- Active Inquiries -->
            <a href="estelam.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-file-contract"></i></div>
                <div class="modal-item-name">استعلام سند</div>
                <div class="favorite-icon" data-id="inquiry1"><i class="far fa-heart"></i></div>
            </a>
            <a href="vekalatnameh.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-stamp"></i></div>
                <div class="modal-item-name">استعلام وکالتنامه</div>
                <div class="favorite-icon" data-id="inquiry2"><i class="far fa-heart"></i></div>
            </a>
            <a href="sayadcheck.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-money-check-alt"></i></div>
                <div class="modal-item-name">استعلام چک</div>
                <div class="favorite-icon" data-id="inquiry3"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Active Services -->
            <a href="akhbar.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-newspaper"></i></div>
                <div class="modal-item-name">اخبار ملکی</div>
                <div class="favorite-icon" data-id="service3"><i class="far fa-heart"></i></div>
            </a>
            <a href="businesscard.html" class="modal-item limited-feature" data-feature="businesscard">
                <div class="modal-item-icon"><i class="fas fa-id-card"></i></div>
                <div class="modal-item-name">کارت ویزیت</div>
                <div class="favorite-icon" data-id="service5"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Active Social -->
            <a href="checklist-content.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-clipboard-check"></i></div>
                <div class="modal-item-name">چک لیست تولید محتوا</div>
                <div class="favorite-icon" data-id="social1"><i class="far fa-heart"></i></div>
            </a>
            <a href="follower-management.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-users"></i></div>
                <div class="modal-item-name">مدیریت فالوورها</div>
                <div class="favorite-icon" data-id="social2"><i class="far fa-heart"></i></div>
            </a>
            <a href="content-calendar.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-calendar-alt"></i></div>
                <div class="favorite-icon" data-id="social3"><i class="far fa-heart"></i></div>
                <div class="modal-item-name">تقویم تولید محتوا</div>
            </a>
            <a href="instagram-caption.html" class="modal-item">
                <div class="modal-item-icon"><i class="fab fa-instagram"></i></div>
                <div class="modal-item-name">کپشن اینستاگرام</div>
                <div class="favorite-icon" data-id="social4"><i class="far fa-heart"></i></div>
            </a>
            <a href="direct-marketing.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-paper-plane"></i></div>
                <div class="modal-item-name">دایرکت مارکتینگ</div>
                <div class="favorite-icon" data-id="social5"><i class="far fa-heart"></i></div>
            </a>
            <a href="daily-engagement.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-comments"></i></div>
                <div class="modal-item-name">تعامل روزانه</div>
                <div class="favorite-icon" data-id="social6"><i class="far fa-heart"></i></div>
            </a>

            <!-- Active Websites -->
            <a href="KHODNEVIS.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-globe"></i></div>
                <div class="modal-item-name">سایت خودنویس</div>
                <div class="favorite-icon" data-id="website1"><i class="far fa-heart"></i></div>
            </a>
            <a href="kateb.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-globe"></i></div>
                <div class="modal-item-name">سامانه کاتب</div>
                <div class="favorite-icon" data-id="website4"><i class="far fa-heart"></i></div>
            </a>
            <a href="sabteman.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-id-card-alt"></i></div>
                <div class="modal-item-name">سایت ثبت من</div>
                <div class="favorite-icon" data-id="website3"><i class="far fa-heart"></i></div>
            </a>

            <!-- Active Tools -->
            <a href="lightner.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-box-open"></i></div>
                <div class="modal-item-name">جعبه لایتنر</div>
                <div class="favorite-icon" data-id="tool1"><i class="far fa-heart"></i></div>
            </a>
            <a href="num-to-word.html" class="modal-item">
                <div class="modal-item-icon"><i class="fas fa-spell-check"></i></div>
                <div class="modal-item-name">تبدیل عدد به حروف</div>
                <div class="favorite-icon" data-id="tool5"><i class="far fa-heart"></i></div>
            </a>
        </div>

        <div class="modal-section-title">به زودی فعال می‌شوند</div>
        <div class="modal-grid">
            <!-- Disabled Calculations -->
            <a href="#" class="modal-item disabled" id="mohasebeEjareModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-key"></i></div>
                <div class="modal-item-name">محاسبه اجاره</div>
                <div class="favorite-icon" data-id="calc12"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="kharjkardSakhtemanModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-hammer"></i></div>
                <div class="modal-item-name">خرجکرد ساختمان</div>
                <div class="favorite-icon" data-id="calc6"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="sharjSakhtemanModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                <div class="modal-item-name">شارژ ساختمان</div>
                <div class="favorite-icon" data-id="calc8"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="commissionCalcModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-percentage"></i></div>
                <div class="modal-item-name">محاسبه کمیسیون</div>
                <div class="favorite-icon" data-id="calc5"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="totalPriceCalcModal">
                <div class="modal-item-icon"><i class="fas fa-coins"></i></div>
                <div class="modal-item-name">قیمت کل آپارتمان</div>
                <div class="favorite-icon" data-id="calc10"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="constructionCalcModal">
                <div class="modal-item-icon"><i class="fas fa-hammer"></i></div>
                <div class="modal-item-name">هزینه ساخت</div>
                <div class="favorite-icon" data-id="calc6_construction"><i class="far fa-heart"></i></div>
            </a>

            <!-- Disabled Inquiries -->
            <a href="#" class="modal-item disabled" id="postalCodeInquiryModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-map-pin"></i></div>
                <div class="modal-item-name">تاییدیه کد پستی</div>
                <div class="favorite-icon" data-id="inquiry4"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="checkRegistrationModal">
                <div class="modal-item-icon"><i class="fas fa-check-circle"></i></div>
                <div class="modal-item-name">ثبت چک</div>
                <div class="favorite-icon" data-id="inquiry5"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Disabled Services -->
            <a href="#" class="modal-item disabled" id="moshtarianModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-users"></i></div>
                <div class="modal-item-name">مشتریان</div>
                <div class="favorite-icon" data-id="service7"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="yaddashtModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-sticky-note"></i></div>
                <div class="modal-item-name">یادداشت‌ها</div>
                <div class="favorite-icon" data-id="service6"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="akharinMoamelatModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-chart-bar"></i></div>
                <div class="modal-item-name">آخرین معاملات</div>
                <div class="favorite-icon" data-id="service11"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Disabled Education -->
            <a href="#" class="modal-item disabled" id="amoozeshMatniModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-file-alt"></i></div>
                <div class="modal-item-name">آموزش متنی</div>
                <div class="favorite-icon" data-id="edu1"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="amoozeshSotiModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-volume-up"></i></div>
                <div class="modal-item-name">آموزش صوتی</div>
                <div class="favorite-icon" data-id="edu2"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="amoozeshTasviriModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-video"></i></div>
                <div class="modal-item-name">آموزش تصویری</div>
                <div class="favorite-icon" data-id="edu3"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Disabled Tools -->
            <a href="#" class="modal-item disabled" id="sarresidYadavaModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-bell"></i></div>
                <div class="modal-item-name">سررسیدها و یادآورها</div>
                <div class="favorite-icon" data-id="tool3"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="modal-item disabled" id="gozareshKariModal_disabled">
                <div class="modal-item-icon"><i class="fas fa-chart-pie"></i></div>
                <div class="modal-item-name">گزارش کاری</div>
                <div class="favorite-icon" data-id="tool2"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
</div>
<div class="limit-modal" id="limitModal">
    <div class="limit-modal-content">
        <h3 class="limit-modal-title">محدودیت استفاده رایگان</h3>
        <p class="limit-modal-text">شما از حد مجاز استفاده رایگان (۳ بار) عبور کرده‌اید. برای ادامه استفاده از این قابلیت، لطفاً اشتراک خریداری کنید.</p>
        <div class="limit-modal-buttons">
            <a href="eshterak.html" class="limit-modal-btn primary">خرید اشتراک</a>
            <button class="limit-modal-btn secondary" id="closeLimitModal">بستن</button>
        </div>
    </div>
</div>
<div class="toast-message" id="favoriteToast"></div>
<div class="toast-message" id="disabledFeatureToast">این قابلیت به زودی فعال می‌شود</div>


<div id="payment-container" style="display: none;">
 <div>
 <i class="fas fa-exclamation-circle" style="font-size: 60px; color: var(--primary-color); margin-bottom: 20px;"></i>
 <h2>حساب شما فعال نیست</h2>
 <p>دوره آزمایشی شما به پایان رسیده است. برای دسترسی کامل، اشتراک خود را فعال کنید.</p>
 <button id="pay-now-button"><i class="fas fa-credit-card"></i> فعال‌سازی و پرداخت</button>
 <button id="logout-button-payment"><i class="fas fa-sign-out-alt"></i> خروج از حساب</button>
 <p id="payment-message"></p>
 </div>
</div>

<!-- هدر و سایدبار -->
<header class="header">
 <div class="hamburger-menu">
    <button class="menu-tab-button" id="hamburgerIcon"><i class="fas fa-bars"></i></button>
 </div>
 <div class="logo-container">
    <div class="logo-placeholder"></div> 
 </div>
 <div class="header-icons-wrapper">
    <a href="tablighat.html" class="header-icon-button" id="adsIcon" title="تبلیغات"><i class="fas fa-bullhorn"></i></a>
    <a href="message.html" class="header-icon-button" id="messagesIcon" title="پیام‌ها">
        <i class="fas fa-envelope"></i>
        <span id="unread-badge" class="unread-badge"></span>
    </a>
 </div>
</header>

<div class="overlay" id="overlay"></div>

<div class="sidebar" id="sidebar">
 <div class="sidebar-header">
    <div class="sidebar-logo"><img src="images/logo.png" alt="لوگو" class="sidebar-logo-image"></div>
    <button class="sidebar-close" id="sidebarClose"><i class="fas fa-times"></i></button>
 </div>
 <div class="user-profile" id="userProfile">
    <div class="user-avatar"><i class="fas fa-user"></i></div>
    <div class="user-info"><h3 id="userName"></h3><p id="userEmail"></p></div>
 </div>
 <div class="sidebar-menu">
    <a href="about-app.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-info-circle"></i></div><div class="sidebar-menu-text">درباره برنامه</div></a>
    <a href="amoozesh.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-video"></i></div><div class="sidebar-menu-text">آموزش ویدئویی</div></a>
    <a href="message.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-envelope"></i></div><div class="sidebar-menu-text">پیام‌ها</div></a>
    <a href="karbari.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-user-circle"></i></div><div class="sidebar-menu-text">حساب کاربری</div></a>
    <a href="contact.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-headset"></i></div><div class="sidebar-menu-text">راه‌های ارتباطی</div></a>
    <a href="settings.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-cog"></i></div><div class="sidebar-menu-text">تنظیمات</div></a>
    <a href="admin.html" class="sidebar-menu-item"><div class="sidebar-menu-icon"><i class="fas fa-user-shield"></i></div><div class="sidebar-menu-text">ادمین</div></a>
    <div class="sidebar-menu-item logout" id="logoutButtonSidebar"><div class="sidebar-menu-icon"><i class="fas fa-sign-out-alt"></i></div><div class="sidebar-menu-text">خروج از حساب</div></div>
 </div>
 <div class="sidebar-footer"><div class="sidebar-version">نسخه 1.0.0</div></div>
</div>

<!-- محتوای اصلی صفحه -->
<div id="app-container">
    <!-- .top-banner-wrapper - این بخش به طور کامل حذف شده است -->

    <div class="date-banner" id="persianDateContainer"></div>
    
    <div class="motivational-wrapper">
        <div class="motivational-widget">
            <div class="motivational-label">متن امروز</div> <!-- NEW: Motivational label -->
            <div class="motivational-quote-container">
                <p id="daily-quote">در حال بارگذاری...</p>
            </div>
        </div>
    </div>

    <!-- NEW: Random News Section -->
    <div class="random-news-section-wrapper">
        <div class="news-label">اخبار</div> <!-- NEW: News label -->
        <div id="randomNewsContainer" class="news-highlights-grid">
            <!-- Random news card will be injected here by JavaScript -->
        </div>
        <div id="randomNewsLoading" class="info-message loading" style="display: none;">
            <i class="fas fa-spinner"></i>
            <div>در حال بارگذاری اخبار منتخب...</div>
        </div>
        <div id="randomNewsError" class="info-message error" style="display: none;">
            <h3>خطا در بارگذاری اخبار</h3>
            <p>لطفاً اتصال اینترنت خود را بررسی کرده و دوباره تلاش کنید.</p>
        </div>
        <div id="randomNoNews" class="info-message no-news" style="display: none;">
            <h3>خبری یافت نشد</h3>
            <p>متأسفانه خبری برای نمایش پیدا نشد.</p>
        </div>
    </div>
    <!-- END NEW: Random News Section -->

    <div class="search-container" id="searchContainer">
        <div class="search-box">
            <input type="text" class="search-input" placeholder="جستجو..." id="searchInput">
            <i class="fas fa-search search-icon"></i>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>

    <div class="price-component-container">
        <div class="price-label">قیمت لحظه‌ای</div> <!-- NEW: Price label -->
        <iframe src="gheymat.bazar.html" class="price-iframe" scrolling="no" onerror="this.style.display='none'; this.after(document.createTextNode('خطا در بارگذاری قیمت لحظه‌ای.'));"></iframe>
    </div>
    
    <div class="tabs-container">
        <div class="tab-scroll-arrow left" id="tabScrollLeft"><i class="fas fa-chevron-left"></i></div>
        <div class="tabs-nav" id="tabsNav">
            <button class="tab-button active" data-tab="calculations">محاسبات</button>
            <button class="tab-button" data-tab="inquiries">استعلامات</button>
            <button class="tab-button" data-tab="services">خدمات</button>
            <button class="tab-button" data-tab="social">فضای مجازی</button>
            <button class="tab-button" data-tab="websites">سایت‌ها</button>
            <button class="tab-button" data-tab="education">آموزش</button>
            <button class="tab-button" data-tab="tools">ابزارها</button>
            <button class="tab-button" data-tab="files">فایل‌ها</button>
        </div>
        <div class="tab-scroll-arrow right" id="tabScrollRight"><i class="fas fa-chevron-right"></i></div>
    </div>
    
    <div class="tab-content active" id="calculations-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="apartment-calculator.html" class="calc-item limited-feature" data-feature="apartment-calculator">
                <div class="calc-image"><i class="fas fa-building"></i></div>
                <div class="calc-name">قیمت آپارتمان</div>
                <div class="favorite-icon" data-id="calc1"><i class="far fa-heart"></i></div>
            </a>
            <a href="villa-calculator.html" class="calc-item limited-feature" data-feature="villa-calculator">
                <div class="calc-image"><i class="fas fa-home"></i></div>
                <div class="calc-name">قیمت ویلا</div>
                <div class="favorite-icon" data-id="calc2"><i class="far fa-heart"></i></div>
            </a>
            <a href="rent-converter.html" class="calc-item limited-feature" data-feature="rent-converter">
                <div class="calc-image"><i class="fas fa-exchange-alt"></i></div>
                <div class="calc-name">تبدیل رهن و اجاره</div>
                <div class="favorite-icon" data-id="calc4"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg2.png');"></a>
            </div>
            <a href="apartment-share-calculator.html" class="calc-item limited-feature" data-feature="apartment-share-calculator">
                <div class="calc-image"><i class="fas fa-calculator"></i></div>
                <div class="calc-name">قدرالسهم آپارتمان</div>
                <div class="favorite-icon" data-id="calc9"><i class="far fa-heart"></i></div>
            </a>
            <a href="hesabdari.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-chart-line"></i></div>
                <div class="calc-name">حسابداری</div>
                <div class="favorite-icon" data-id="calc11"><i class="far fa-heart"></i></div>
            </a>
            
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="mohasebeejareh">
                <div class="calc-image"><i class="fas fa-key"></i></div>
                <div class="calc-name">محاسبه اجاره</div>
                <div class="favorite-icon" data-id="calc12"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="kharjkardSakhteman">
                <div class="calc-image"><i class="fas fa-hammer"></i></div>
                <div class="calc-name">خرجکرد ساختمان</div>
                <div class="favorite-icon" data-id="calc6"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="sharjSakhteman">
                <div class="calc-image"><i class="fas fa-file-invoice-dollar"></i></div>
                <div class="calc-name">شارژ ساختمان</div>
                <div class="favorite-icon" data-id="calc8"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="commissionCalc">
                <div class="calc-image"><i class="fas fa-percentage"></i></div>
                <div class="calc-name">محاسبه کمیسیون</div>
                <div class="favorite-icon" data-id="calc5"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="inquiries-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="estelam.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-file-contract"></i></div>
                <div class="calc-name">استعلام سند</div>
                <div class="favorite-icon" data-id="inquiry1"><i class="far fa-heart"></i></div>
            </a>
            <a href="vekalatnameh.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-stamp"></i></div>
                <div class="calc-name">استعلام وکالتنامه</div>
                <div class="favorite-icon" data-id="inquiry2"><i class="far fa-heart"></i></div>
            </a>
            <a href="sayadcheck.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-money-check-alt"></i></div>
                <div class="calc-name">استعلام چک</div>
                <div class="favorite-icon" data-id="inquiry3"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg2.png');"></a>
            </div>
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="taidiyeCodeposti">
                <div class="calc-image"><i class="fas fa-map-pin"></i></div>
                <div class="calc-name">تاییدیه کد پستی</div>
                <div class="favorite-icon" data-id="inquiry4"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="services-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="akhbar.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-newspaper"></i></div>
                <div class="calc-name">اخبار ملکی</div>
                <div class="favorite-icon" data-id="service3"><i class="far fa-heart"></i></div>
            </a>
            <a href="businesscard.html" class="calc-item limited-feature" data-feature="businesscard">
                <div class="calc-image"><i class="fas fa-id-card"></i></div>
                <div class="calc-name">کارت ویزیت</div>
                <div class="favorite-icon" data-id="service5"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg1.png');"></a>
            </div>
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="moshtarian">
                <div class="calc-image"><i class="fas fa-users"></i></div>
                <div class="calc-name">مشتریان</div>
                <div class="favorite-icon" data-id="service7"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="akharinMoamelat">
                <div class="calc-image"><i class="fas fa-chart-bar"></i></div>
                <div class="calc-name">آخرین معاملات</div>
                <div class="favorite-icon" data-id="service11"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="yaddasht">
                <div class="calc-image"><i class="fas fa-sticky-note"></i></div>
                <div class="calc-name">یادداشت‌ها</div>
                <div class="favorite-icon" data-id="service6"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="social-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="follower-management.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-users"></i></div>
                <div class="calc-name">مدیریت فالوورها</div>
                <div class="favorite-icon" data-id="social1"><i class="far fa-heart"></i></div>
            </a>
            <a href="following.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-user-check"></i></div>
                <div class="calc-name">مدیریت فالویینگ‌ها</div>
                <div class="favorite-icon" data-id="social2"><i class="far fa-heart"></i></div>
            </a>
            <a href="direct-marketing.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-paper-plane"></i></div>
                <div class="calc-name">دایرکت مارکتینگ</div>
                <div class="favorite-icon" data-id="social3"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg1.png');"></a>
            </div>
            <a href="content-calendar.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-calendar-alt"></i></div>
                <div class="calc-name">تقویم محتوا</div>
                <div class="favorite-icon" data-id="social4"><i class="far fa-heart"></i></div>
            </a>
            <a href="daily-engagement.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-heart"></i></div>
                <div class="calc-name">تعامل روزانه</div>
                <div class="favorite-icon" data-id="social5"><i class="far fa-heart"></i></div>
            </a>
            <a href="checklist-content.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-tasks"></i></div>
                <div class="calc-name">چک‌لیست محتوا</div>
                <div class="favorite-icon" data-id="social6"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="websites-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="KHODNEVIS.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-globe"></i></div>
                <div class="calc-name">سایت خودنویس</div>
                <div class="favorite-icon" data-id="website1"><i class="far fa-heart"></i></div>
            </a>
            <a href="kateb.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-book"></i></div>
                <div class="calc-name">سامانه کاتب</div>
                <div class="favorite-icon" data-id="website4"><i class="far fa-heart"></i></div>
            </a>
            <a href="sabteman.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-id-card-alt"></i></div>
                <div class="calc-name">سایت ثبت من</div>
                <div class="favorite-icon" data-id="website3"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg2.png');"></a>
            </div>
        </div>
    </div>
    <div class="tab-content" id="education-tab">
        <div class="calc-container">
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg1.png');"></a>
            </div>
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="amoozeshMatni">
                <div class="calc-image"><i class="fas fa-file-alt"></i></div>
                <div class="calc-name">آموزش متنی</div>
                <div class="favorite-icon" data-id="edu1"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="amoozeshSoti">
                <div class="calc-image"><i class="fas fa-volume-up"></i></div>
                <div class="calc-name">آموزش صوتی</div>
                <div class="favorite-icon" data-id="edu2"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="amoozeshTasviri">
                <div class="calc-image"><i class="fas fa-video"></i></div>
                <div class="calc-name">آموزش تصویری</div>
                <div class="favorite-icon" data-id="edu3"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="tools-tab">
        <div class="calc-container">
            <!-- Active Items -->
            <a href="lightner.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-box-open"></i></div>
                <div class="calc-name">جعبه لایتنر</div>
                <div class="favorite-icon" data-id="tool1"><i class="far fa-heart"></i></div>
            </a>
            <a href="num-to-word.html" class="calc-item">
                <div class="calc-image"><i class="fas fa-spell-check"></i></div>
                <div class="calc-name">تبدیل عدد به حروف</div>
                <div class="favorite-icon" data-id="tool5"><i class="far fa-heart"></i></div>
            </a>
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg2.png');"></a>
            </div>
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="sarresidYadava">
                <div class="calc-image"><i class="fas fa-bell"></i></div>
                <div class="calc-name">سررسیدها و یادآورها</div>
                <div class="favorite-icon" data-id="tool3"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="gozareshKari">
                <div class="calc-image"><i class="fas fa-chart-pie"></i></div>
                <div class="calc-name">گزارش کاری</div>
                <div class="favorite-icon" data-id="tool2"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>
    <div class="tab-content" id="files-tab">
        <div class="calc-container">
            <div class="banner-container">
                <a href="tablighat.html" class="banner-full" style="background-image: url('images/sarbarg1.png');"></a>
            </div>
            <!-- Disabled Items (at the end of the list) -->
            <a href="#" class="calc-item disabled" id="bazdid">
                <div class="calc-image"><i class="fas fa-clipboard-list"></i></div>
                <div class="calc-name">چک لیست بازدید</div>
                <div class="favorite-icon" data-id="file1"><i class="far fa-heart"></i></div>
            </a>
            <a href="#" class="calc-item disabled" id="bandGharardad">
                <div class="calc-image"><i class="fas fa-file-signature"></i></div>
                <div class="calc-name">بندهای قراردادی</div>
                <div class="favorite-icon" data-id="file2"><i class="far fa-heart"></i></div>
            </a>
        </div>
    </div>

    <div id="payment-iframe-container" style="display:none;"></div>
    
    <div class="bottom-nav">
        <a href="#" class="nav-item" id="showAllToolsBtn">
            <i class="fas fa-th-large"></i>
            <span>همه ابزارها</span>
        </a>
        <a href="favorites.html" class="nav-item">
            <i class="fas fa-heart"></i>
            <span>علاقه‌مندی‌ها</span>
        </a>
        <a href="#" class="nav-item" id="searchButtonBottomNav">
            <i class="fas fa-search"></i>
            <span>جستجو</span>
        </a>
        <a href="karbari.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>حساب کاربری</span>
        </a>
    </div>
</div>

<script src="quotes.js"></script>
<script>
// --- START: Global Functions ---
let currentUserEmail = null; 
let currentDeviceId = null; 
let conflictingLoginEmail = null;
let allFetchedNews = [];
let currentNewsIndex = 0; 
const numberOfRandomNews = 1; 
let newsIntervalId; 

// Helper function for making requests to the worker
async function makeWorkerRequest(endpoint, data = null, method = 'GET') { 
    const url = `https://weathered-sun-e806.toolbox-moein.workers.dev${endpoint}`; 
    const options = { method: method, headers: { 'Content-Type': 'application/json' } }; 
    const sessionToken = localStorage.getItem('sessionToken'); 
    if (sessionToken) { options.headers['Authorization'] = `Bearer ${sessionToken}`; } 
    if (data && method !== 'GET') { options.body = JSON.stringify(data); } 
    try { 
        const response = await fetch(url, options); 
        const result = await response.json(); 
        return { success: response.ok, status: response.status, data: result }; 
    } catch (error) { 
        console.error('Request failed:', error); 
        return { success: false, error: 'خطای شبکه رخ داد' }; 
    } 
}

// Authentication/Session related functions
function goToRegister() { window.location.href = 'register.html'; }
function generateDeviceId() { let deviceId = localStorage.getItem('deviceId'); if (!deviceId) { deviceId = 'device-' + Math.random().toString(36).substr(2, 9) + '-' + Date.now(); localStorage.setItem('deviceId', deviceId); } return deviceId; }

async function checkSession() { 
    const sessionToken = localStorage.getItem('sessionToken'); 
    if (!sessionToken) { return null; } 
    const result = await makeWorkerRequest('/getsession', null, 'POST'); 
    if (result.success && result.data && result.data.user) { return result.data; } 
    else { localStorage.removeItem('sessionToken'); return null; } 
}

async function performLogout() { 
    try { await makeWorkerRequest('/signout', null, 'POST'); } 
    catch (error) { console.error("Logout error:", error); } 
    localStorage.removeItem('sessionToken'); 
    localStorage.removeItem('deviceId'); 
    showNoSessionPage(); 
}

function showNoSessionPage() { 
    const elementsToHide = ['.header', '#app-container', '#payment-container']; 
    elementsToHide.forEach(selector => { const el = document.querySelector(selector); if(el) el.style.display = 'none'; }); 
    const noSessionContainer = document.getElementById('no-session-container'); 
    if(noSessionContainer) noSessionContainer.style.display = 'flex'; 
}

async function loadUserProfile() { 
    const session = await checkSession(); 
    if (!session || !session.user) { 
        const userNameElem = document.getElementById('userName');
        if (userNameElem) userNameElem.textContent = 'مهمان'; 
        return; 
    } 
    const { firstName = '', lastName = '' } = session.user; 
    const fullName = `${firstName} ${lastName}`.trim(); 
    const userNameElem = document.getElementById('userName');
    if (userNameElem) userNameElem.textContent = fullName || session.user.email; 
}

function handlePaymentResult() { 
    const urlParams = new URLSearchParams(window.location.search); 
    const paymentStatus = urlParams.get('payment'); 
    if (!paymentStatus) return; 
    const notification = document.getElementById('payment-notification'); 
    const icon = document.getElementById('notification-icon'); 
    const title = document.getElementById('notification-title'); 
    const message = document.getElementById('notification-message'); 
    const closeBtn = document.getElementById('notification-close'); 
    let notificationTimeout; 
    function showNotification(type, titleText, messageText) { 
        clearTimeout(notificationTimeout); 
        if (notification) notification.className = `payment-notification ${type} show`; 
        if (icon) icon.className = `notification-icon fas ${type === 'success' ? 'fa-check-circle' : 'fa-times-circle'}`; 
        if (title) title.textContent = titleText; 
        if (message) message.textContent = messageText; 
        notificationTimeout = setTimeout(() => { if(notification) notification.classList.remove('show'); }, 5000); 
    } 
    if (closeBtn) closeBtn.onclick = () => { clearTimeout(notificationTimeout); if(notification) notification.classList.remove('show'); }; 
    if (paymentStatus === 'success') { showNotification('success', 'پرداخت موفق', 'اشتراک شما با موفقیت فعال گردید.'); } 
    else if (paymentStatus === 'failed') { showNotification('failed', 'پرداخت ناموفق', 'پرداخت لغو شد یا با خطا مواجه گردید.'); } 
    history.replaceState(null, '', window.location.pathname); 
}

function loadPaymentPage() {
    const tabsContainer = document.querySelector('.tabs-container');
    if (tabsContainer) tabsContainer.style.display = 'none';
    document.querySelectorAll('.tab-content').forEach(el => { if(el) el.style.display = 'none'; });
    const motivationalWrapper = document.querySelector('.motivational-wrapper');
    if (motivationalWrapper) motivationalWrapper.style.display = 'none';
    const container = document.getElementById('payment-iframe-container');
    if (container) {
        container.style.display = 'block';
        const iframe = document.createElement('iframe'); 
        iframe.style.cssText = 'width: 100%; height: 80vh; border: none; border-radius: var(--border-radius);'; 
        iframe.src = 'payment.html'; 
        container.innerHTML = ''; 
        container.appendChild(iframe);
    }
}

async function checkUnreadMessages() {
    const badge = document.getElementById('unread-badge');
    if (!badge) return;
    try {
        const readMessages = JSON.parse(localStorage.getItem('readMessages')) || [];
        const WELCOME_MESSAGE = { id: 'static-welcome-message' };
        const AD_MESSAGE = { id: 'static-ad-message' };
        const response = await makeWorkerRequest('/messages');
        let dynamicMessages = [];
        if (response.success && Array.isArray(response.data.messages)) {
            dynamicMessages = response.data.messages;
        }
        const allMessages = [WELCOME_MESSAGE, AD_MESSAGE, ...dynamicMessages];
        const unreadCount = allMessages.filter(msg => msg.id && !readMessages.includes(msg.id)).length;
        if (unreadCount > 0) {
            badge.textContent = unreadCount;
            badge.classList.add('show');
        } else {
            badge.classList.remove('show');
        }
    } catch (error) {
        console.error("Error checking unread messages:", error);
        badge.classList.remove('show');
    }
}

// Date display function
function showPersianDate() {
    const now = new Date();
    const weekday = now.toLocaleDateString('fa-IR', { weekday: 'long' });
    const day = now.toLocaleDateString('fa-IR', { day: 'numeric' });
    const month = now.toLocaleDateString('fa-IR', { month: 'long' });
    const year = now.toLocaleDateString('fa-IR', { year: 'numeric' });
    const formattedDate = `${weekday} <span class="separator">|</span> ${day}${month} ${year}`;

    const currentGregorianYear = now.getFullYear();
    let nowruz = new Date(currentGregorianYear, 2, 21); // Month March is index 2
    
    if (now > nowruz) {
        nowruz = new Date(currentGregorianYear + 1, 2, 21);
    }

    const timeDifference = nowruz.getTime() - now.getTime();
    const daysRemaining = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));
    const persianDaysRemaining = daysRemaining.toLocaleString('fa-IR', { useGrouping: false });
    const countdownText = `${persianDaysRemaining} روز تا پایان سال`;

    const finalOutput = `${formattedDate} <span class="separator">|</span> ${countdownText}`;
    const persianDateContainer = document.getElementById('persianDateContainer');
    if (persianDateContainer) { 
        persianDateContainer.innerHTML = finalOutput;
    }
}

// Motivational quote display function
function displayMotivationalQuote() {
    // Check if 'quotes' array exists and is not empty (from quotes.js)
    if (typeof quotes === 'undefined' || !Array.isArray(quotes) || quotes.length === 0) {
        const dailyQuoteElem = document.getElementById('daily-quote');
        if (dailyQuoteElem) { 
            dailyQuoteElem.textContent = 'خطا در بارگذاری جملات.';
        }
        return;
    }
    const epoch = new Date('2025-01-01T06:00:00'); // Consistent epoch for daily quotes
    const now = new Date();
    const diffTime = now - epoch;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    const quoteIndex = diffDays % quotes.length;
    const selectedQuote = quotes[quoteIndex];
    const dailyQuoteElem = document.getElementById('daily-quote');
    if (dailyQuoteElem) { 
        dailyQuoteElem.textContent = selectedQuote;
    }
}


// News highlights functions
const topPriorityKeywords = ['دلار', 'مسکن', 'املاک', 'ملک', 'ملکی', 'ارز', 'طلا', 'سکه'];
const keywordFilters = {
    real_estate: ['اجاره', 'شهرداری', 'وام مسکن', 'طرح ملی مسکن', 'بافت فرسوده', 'انبوه سازی', 'شهرسازی', 'زمین', 'ویلا', 'آپارتمان', 'خرید خانه', 'قیمت خانه'],
    economy: ['اقتصاد', 'بازار', 'بورس', 'سهام', 'یورو', 'قیمت', 'تورم', 'بانک', 'وام', 'بودجه', 'مالیات', 'تجارت', 'صادرات', 'واردات', 'نفت', 'یارانه', 'حقوق', 'سرمایه‌گذاری', 'شاخص کل', 'سهام عدالت'],
    politics: ['سیاست', 'دولت', 'مجلس', 'رئیس جمهور', 'وزیر', 'نماینده', 'انتخابات', 'برجام', 'تحریم', 'مذاکره']
};
const negativeKeywords = [
    'فوتبال', 'ورزش', 'لیگ', 'تیم', 'بازیکن', 'المپیک', 'مدال', 
    'سینما', 'بازیگر', 'موسیقی', 'حوادث', 'تصادف', 'سوانح', 'سرقت', 'جرم', 
    'سلامت', 'تکنولوژی', 'پزشکی', 'گردشگری', 'خودرو', 'فرهنگی', 'هنری', 
    'اجتماعی', 'بین الملل', 'جهان', 'خارجی', 'آسیب', 'آلودگی', 'محیط زیست', 'طبیعت', 'آب و هوا', 'خشکسالی', 'باران', 
    'غذا', 'آشپزی', 'رستوران', 'خوراک', 'نوشیدنی', 'تغذیه', 
    'مدارس', 'مدرسه', 'دانشگاه', 'دانشجو', 'آموزش', 'پرورش', 'معلم', 'استاد', 'کنکور', 'امتحان', 'حوزه علمیه', 'حوزه', 
    'بهداشت', 'درمان', 'بیمارستان', 'پزشک', 'دارو', 'بیماری', 'کرونا', 'واکسن', 
    'حضرت', 'رسول', 'امام', 'دین', 'مذهب', 'شهادت', 'وفات', 'میلاد', 'جشنواره', 'نمایشگاه', 'کتاب', 'ادبیات', 
    'خانواده', 'ازدواج', 'طلاق', 'کودک', 'جوانان', 'سالمندان', 'زنان', 'مردان', 
    'سوریه', 'غزه', 'اوکراین', 'فلسطین'
];

function detectNewsCategory(title, description) {
    const combinedText = (title + ' ' + (description || '')).toLowerCase();
    if (negativeKeywords.some(keyword => combinedText.includes(keyword))) return 'other';
    
    if (keywordFilters.real_estate.some(keyword => combinedText.includes(keyword)) || topPriorityKeywords.some(keyword => combinedText.includes(keyword))) return 'real_estate';
    if (keywordFilters.economy.some(keyword => combinedText.includes(keyword))) return 'economy';
    if (keywordFilters.politics.some(keyword => combinedText.includes(keyword))) return 'politics';
    return 'other';
}

const sourceNameMap = {
    'خبرگزاری تسنیم': 'خبرگزاری تسنیم', 'خبرگزاری مهر': 'خبرگزاری مهر',
    'خبرگزاری ايسنا': 'خبرگزاری ایسنا', 'خبرگزاری ایسنا': 'خبرگزاری ایسنا',
    'تجارت نیوز': 'تجارت نیوز', 'دنیای اقتصاد': 'دنیای اقتصاد',
    'خبرگزاری فارس': 'خبرگزاری فارس', 'خبرگزاری جمهوری اسلامی': 'خبرگزاری ایرنا',
    'خبرگزاری تابناک': 'تابناک', 'اقتصاد آنلاین': 'اقتصاد آنلاین'
};
function cleanSourceName(originalName) {
    for (const key in sourceNameMap) {
        if (originalName.includes(key)) return sourceNameMap[key];
    }
    return originalName.split('|')[0].trim();
}

function createNewsHighlightCard(news) {
    const card = document.createElement('div'); 
    card.className = 'news-item-card'; 
    card.setAttribute('data-news-url', news.url); 
    
    card.innerHTML = `
        <div class="card-content">
            <h3 class="news-title-text">${news.title}</h3>
            <div class="news-footer-info">
                <span class="read-more-cue">ادامه خبر <i class="fas fa-chevron-left"></i></span>
            </div>
        </div>`;
    
    card.addEventListener('click', () => {
        window.location.href = 'akhbar.html'; 
    });

    return card;
}

async function fetchAndProcessNewsForHighlights() {
    const sectionWrapper = document.querySelector('.random-news-section-wrapper');
    const loadingElem = document.getElementById('randomNewsLoading');
    const errorElem = document.getElementById('randomNewsError');
    const noNewsElem = document.getElementById('randomNoNews');
    const container = document.getElementById('randomNewsContainer');

    // Hide everything first within the sectionWrapper
    if (loadingElem) loadingElem.style.display = 'none';
    if (errorElem) errorElem.style.display = 'none';
    if (noNewsElem) noNewsElem.style.display = 'none';
    if (container) {
        container.innerHTML = ''; 
        container.style.display = 'none'; 
    }

    // Show loading message, making sure the section wrapper is visible to display it
    if (sectionWrapper) sectionWrapper.style.display = 'block'; 
    if (loadingElem) loadingElem.style.display = 'flex'; 

    // Clear previous interval if any
    if (newsIntervalId) {
        clearInterval(newsIntervalId);
    }

    const rssFeeds = [
        'https://tejaratnews.com/feed/section/housing', 
        'https://www.donya-e-eqtesad.com/fa/tiny/feed',
        'https://www.isna.ir/rss/tp/14', 
        'https://www.mehrnews.com/rss/tp/8' 
    ];
    
    const rssToJsonService = 'https://api.rss2json.com/v1/api.json?rss_url=';
    const requests = rssFeeds.map(feed => fetch(rssToJsonService + encodeURIComponent(feed)));
    const responses = await Promise.allSettled(requests);
    
    let newsItems = [];
    for (const result of responses) {
        if (result.status === 'fulfilled') {
            try {
                const data = await result.value.json();
                if (data.status === 'ok' && data.items) {
                    const sourceName = cleanSourceName(data.feed.title);
                    const itemsWithSource = data.items.map(item => ({...item, sourceName }));
                    newsItems.push(...itemsWithSource);
                }
            } catch (e) { console.error("خطا در پردازش فید (اخبار رندوم):", e); }
        } else {
            console.error("خطا در دریافت فید (اخبار رندوم):", result.reason);
        }
    }
    
    if (newsItems.length === 0) {
        if (loadingElem) loadingElem.style.display = 'none';
        if (errorElem) errorElem.style.display = 'flex'; 
        return;
    }

    let processedNews = newsItems.map(item => {
        const cleanTitle = item.title ? item.title.replace(/ساخت‌وساز/g, '').replace(/\s\s+/g, ' ').trim() : '';
        let plainDescription = item.description ? item.description.replace(/<[^>]*>?/gm, '') : '';
        plainDescription = plainDescription.replace(/ساخت‌وساز/g, '').replace(/\s\s+/g, ' ').trim();
        plainDescription = plainDescription.substring(0, 200) + (plainDescription.length > 200 ? '...' : '');
        
        const category = detectNewsCategory(cleanTitle, plainDescription);
        if (category === 'real_estate' || category === 'economy' || category === 'politics') { 
             let priority;
            const combinedText = (cleanTitle + ' ' + plainDescription).toLowerCase();

            if (topPriorityKeywords.some(keyword => combinedText.includes(keyword))) {
                priority = 0; 
            } else {
                switch (category) {
                    case 'real_estate': priority = 1; break;
                    case 'economy':     priority = 2; break;
                    case 'politics':    priority = 3; break;
                    default:            priority = 4; 
                }
            }

            return {
                title: cleanTitle, description: plainDescription, url: item.link,
                publishedAt: item.pubDate, category: category, sourceName: item.sourceName,
                id: item.guid || item.link, priority: priority
            };
        }
        return null; 
    }).filter(Boolean); 

    const uniqueUrls = new Set();
    allFetchedNews = processedNews.filter(item => {
        if (uniqueUrls.has(item.url)) return false;
        uniqueUrls.add(item.url);
        return true;
    });

    allFetchedNews.sort((a, b) => {
        if (a.priority !== b.priority) return a.priority - b.priority;
        return new Date(b.publishedAt) - new Date(a.publishedAt);
    });

    if (loadingElem) loadingElem.style.display = 'none'; 
    
    if (allFetchedNews.length === 0) {
        if (noNewsElem) noNewsElem.style.display = 'flex'; 
        return;
    }

    displayRandomNewsHighlights(); 

    if (allFetchedNews.length > 1) { 
        newsIntervalId = setInterval(displayRandomNewsHighlights, 10000); 
    }
}

function displayRandomNewsHighlights() {
    const sectionWrapper = document.querySelector('.random-news-section-wrapper');
    const noNewsElem = document.getElementById('randomNoNews');
    const container = document.getElementById('randomNewsContainer');
    const errorElem = document.getElementById('randomNewsError');


    if (container) {
        container.innerHTML = ''; 
        container.style.display = 'none'; 
    }
    if (noNewsElem) noNewsElem.style.display = 'none'; 
    if (errorElem) errorElem.style.display = 'none'; 


    if (allFetchedNews.length === 0) {
        if (sectionWrapper) sectionWrapper.style.display = 'block'; 
        if (noNewsElem) noNewsElem.style.display = 'flex'; 
        if (newsIntervalId) clearInterval(newsIntervalId); 
        return;
    }

    if (sectionWrapper) sectionWrapper.style.display = 'block'; 

    const newsToDisplay = allFetchedNews[currentNewsIndex];
    if (container) {
        container.appendChild(createNewsHighlightCard(newsToDisplay));
        container.style.display = 'flex'; 
    }

    currentNewsIndex = (currentNewsIndex + 1) % allFetchedNews.length; 
}

// Function to open and close sidebar
function openMenu() { const sidebar = document.getElementById('sidebar'); const overlay = document.getElementById('overlay'); if (sidebar && overlay) { sidebar.classList.add('active'); overlay.classList.add('active'); document.body.style.overflow = 'hidden'; } }
function closeMenu() { const sidebar = document.getElementById('sidebar'); const overlay = document.getElementById('overlay'); if (sidebar && overlay) { sidebar.classList.remove('active'); overlay.classList.remove('active'); document.body.style.overflow = ''; } }


// Main authentication and content display flow
async function checkAuthStateAndDisplayContent() { 
    handlePaymentResult(); 
    currentDeviceId = generateDeviceId(); 
    const urlParams = new URLSearchParams(window.location.search); 
    if (urlParams.get('loginConflict') === 'true' && urlParams.get('email')) { 
        const conflictingEmailDisplay = document.getElementById('conflictingEmailDisplay');
        if (conflictingEmailDisplay) conflictingEmailDisplay.textContent = decodeURIComponent(urlParams.get('email')); 
        const multiDeviceModal = document.getElementById('multiDeviceModal');
        if (multiDeviceModal) multiDeviceModal.classList.add('active'); 
        document.body.style.overflow = 'hidden'; 
        history.replaceState(null, '', window.location.pathname); 
        return; 
    } 
    const session = await checkSession(); 
    if (!session || !session.user) { 
        showNoSessionPage(); 
        return; 
    } 
    currentUserEmail = session.user.email; 
    const { subscriptionStatus, createdAt: userCreatedAt } = session.user; 
    if (!userCreatedAt || !subscriptionStatus) { 
        alert("خطا در دریافت اطلاعات کاربری."); 
        showNoSessionPage(); 
        return; 
    } 
    
    // Ensure the main app containers are visible before populating them
    const headerElem = document.querySelector('.header');
    if (headerElem) headerElem.style.display = 'flex';
    const appContainerElem = document.querySelector('#app-container');
    if (appContainerElem) appContainerElem.style.display = 'flex';

    const isSubscriptionActive = subscriptionStatus === 'active'; 
    const trialEndDate = new Date(new Date(userCreatedAt).getTime() + 7 * 24 * 60 * 60 * 1000); 
    const isTrialPeriod = new Date() <= trialEndDate; 
    
    if (!isSubscriptionActive && !isTrialPeriod && session.user.email !== "toolbox.moein@gmail.com") { 
        loadPaymentPage();
    } 
    
    await loadUserProfile();
    await checkUnreadMessages();

    // Now call the functions that populate content, as the container is visible
    showPersianDate();
    displayMotivationalQuote();
    fetchAndProcessNewsForHighlights(); 
}
// --- END: Global Functions ---


document.addEventListener('DOMContentLoaded', function() { 
    checkAuthStateAndDisplayContent(); 
    
    window.addEventListener('message', (event) => { 
        if (event.data && event.data.type === 'logoutRequest') { 
            performLogout(); 
        } 
    }); 
    
    document.getElementById('hamburgerIcon')?.addEventListener('click', (e) => { e.preventDefault(); openMenu(); }); 
    document.getElementById('sidebarClose')?.addEventListener('click', closeMenu); 
    document.getElementById('overlay')?.addEventListener('click', closeMenu); 
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeMenu(); } }); 
    document.querySelectorAll('#logoutButtonSidebar, #logout-button-payment').forEach(btn => { 
        btn?.addEventListener('click', (e) => { e.preventDefault(); performLogout(); }); 
    }); 
    document.getElementById('confirmSwitchDevice')?.addEventListener('click', () => alert('این قابلیت در حال توسعه است')); 
    document.getElementById('cancelSwitchDevice')?.addEventListener('click', () => { 
        document.getElementById('multiDeviceModal')?.classList.remove('active'); 
        document.body.style.overflow = ''; 
        goToRegister(); 
    }); 
    
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabContents = document.querySelectorAll('.tab-content');
    tabButtons.forEach(button => {
        button.addEventListener('click', function () {
            const tabId = this.getAttribute('data-tab');
            tabButtons.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(content => content.classList.remove('active'));
            this.classList.add('active');
            const targetTab = document.getElementById(`${tabId}-tab`);
            if (targetTab) { 
                targetTab.classList.add('active');
            }
        });
    });

    const tabsNav = document.getElementById('tabsNav');
    const tabScrollLeft = document.getElementById('tabScrollLeft');
    const tabScrollRight = document.getElementById('tabScrollRight');

    function updateScrollArrows() {
        if (!tabsNav || !tabScrollLeft || !tabScrollRight) return; 
        const isRTL = getComputedStyle(tabsNav).direction === 'rtl';
        if (isRTL) {
            tabScrollRight.classList.toggle('hidden', tabsNav.scrollLeft >= 0);
            tabScrollLeft.classList.toggle('hidden', Math.abs(tabsNav.scrollLeft) + tabsNav.clientWidth >= tabsNav.scrollWidth - 5);
        } else {
            tabScrollLeft.classList.toggle('hidden', tabsNav.scrollLeft <= 0);
            tabScrollRight.classList.toggle('hidden', tabsNav.scrollLeft + tabsNav.clientWidth >= tabsNav.scrollWidth - 5);
        }
    }
    tabScrollLeft?.addEventListener('click', () => tabsNav.scrollBy({ left: 100, behavior: 'smooth' })); 
    tabScrollRight?.addEventListener('click', () => tabsNav.scrollBy({ left: -100, behavior: 'smooth' })); 
    tabsNav?.addEventListener('scroll', updateScrollArrows); 
    window.addEventListener('resize', updateScrollArrows);
    updateScrollArrows();

    const searchButton = document.getElementById('searchButtonBottomNav');
    const searchContainer = document.getElementById('searchContainer');
    const searchInput = document.getElementById('searchInput');
    searchButton?.addEventListener('click', function (e) { 
        e.preventDefault();
        searchContainer?.classList.toggle('active'); 
        if (searchContainer?.classList.contains('active')) { 
            searchInput?.focus(); 
        }
    });

    const showAllToolsBtn = document.getElementById('showAllToolsBtn');
    const allToolsModal = document.getElementById('allToolsModal');
    const closeAllToolsModal = document.getElementById('closeAllToolsModal');

    function openModal(modal) { 
        if (modal) { 
            modal.classList.add('active'); 
            document.body.style.overflow = 'hidden';
        }
    }
    function closeModal(modal) { 
        if (modal) { 
            modal.classList.remove('active'); 
            document.body.style.overflow = ''; 
        }
    }

    showAllToolsBtn?.addEventListener('click', (e) => { e.preventDefault(); openModal(allToolsModal) }); 
    closeAllToolsModal?.addEventListener('click', () => closeModal(allToolsModal)); 
    document.getElementById('closeLimitModal')?.addEventListener('click', () => closeModal(document.getElementById('limitModal')));


    const favoriteIcons = document.querySelectorAll('.favorite-icon');
    const favoriteToast = document.getElementById('favoriteToast');
    function showToast(message) {
        if (favoriteToast) { 
            favoriteToast.textContent = message;
            favoriteToast.classList.add('show');
            setTimeout(() => { favoriteToast.classList.remove('show'); }, 2000);
        }
    }
    favoriteIcons.forEach(icon => {
        icon.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            const isFavorite = this.classList.toggle('active');
            this.querySelector('i').className = isFavorite ? 'fas fa-heart' : 'far fa-heart';
            showToast(isFavorite ? 'به علاقه‌مندی‌ها اضافه شد' : 'از علاقه‌مندی‌ها حذف شد');
        });
    });

    const disabledItems = document.querySelectorAll('.calc-item.disabled, .modal-item.disabled');
    const disabledFeatureToast = document.getElementById('disabledFeatureToast');
    disabledItems.forEach(item => {
        item.addEventListener('click', function (e) {
            e.preventDefault();
            if (disabledFeatureToast) { 
                disabledFeatureToast.classList.add('show');
                setTimeout(() => { disabledFeatureToast.classList.remove('show'); }, 2000);
            }
        });
    });
    
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('Service Worker registered with scope:', registration.scope);
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    if (newWorker) {
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    newWorker.postMessage({ type: 'SKIP_WAITING' });
                                    console.log('New Service Worker installed, sent SKIP_WAITING message.');
                                    window.location.reload(); 
                                } else {
                                    console.log('Service Worker: Initial install complete.');
                                }
                            }
                        });
                    }
                });
            })
            .catch(error => { console.error('Service Worker registration failed:', error); });

        navigator.serviceWorker.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'RELOAD_PAGE_AFTER_SW_CLAIM') {
                console.log('Service Worker requested page reload after claiming control.');
                window.location.reload();
            }
            if (event.data && (event.data.type === 'MESSAGE_READ' || event.data.type === 'UPDATE_UNREAD_COUNT')) {
                checkUnreadMessages();
            }
        });
    }
});

window.addEventListener('load', function () {
    const loader = document.getElementById('loading-overlay');
    if (loader) {
        loader.style.opacity = '0';
        setTimeout(() => { loader.style.display = 'none'; }, 500);
    }
});
</script>

</body>
</html>

